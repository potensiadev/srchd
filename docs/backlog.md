# RAI Backlog

## 사용자 피드백 학습 시스템

**우선순위**: 출시 후
**예상 작업량**: 중간

### 개요
사용자가 후보자 정보를 수정하면, 해당 수정 데이터를 수집하여 LLM 프롬프트 품질을 개선하는 시스템

### 흐름

```
[일반 사용자]
    │
    │ 후보자 정보 수정
    │
    ▼
┌─────────────────────────────────┐
│   corrections 테이블 (DB)        │
└─────────────────────────────────┘
    │
    │ 자동 동기화
    │
    ▼
┌─────────────────────────────────────────────────────────────┐
│  Google Sheets: "RAI 수정 데이터"                            │
├─────────────────────────────────────────────────────────────┤
│  일시 | 사용자ID | 필드명 | 원본값 | 수정값 | 사유 | 상태    │
└─────────────────────────────────────────────────────────────┘
    │
    │ 관리자가 시트에서 "상태"를 "승인"으로 변경
    │
    │ 트리거: POST /admin/corrections/sync
    │
    ▼
┌─────────────────────────────────┐
│   few_shot_examples 테이블       │
│   (상태=승인 인 것만 반영)        │
└─────────────────────────────────┘
    │
    ▼
[LLM 프롬프트에 Few-shot 예시로 삽입]
```

### Google Sheets 컬럼 구조

| 컬럼 | 설명 | 예시 |
|------|------|------|
| `correction_id` | 수정 ID | `corr_abc123` |
| `created_at` | 수정 일시 | `2026-01-31 14:30:00` |
| `user_id` | 수정한 사용자 | `user_123` |
| `candidate_id` | 후보자 ID | `cand_xyz789` |
| `field_name` | 수정 필드 | `exp_years` |
| `original_text` | 원본 이력서 일부 | `경력 7년 (군복무 2년 포함)` |
| `llm_output` | LLM이 출력한 값 | `7` |
| `user_correction` | 사용자가 수정한 값 | `5` |
| `reason` | 수정 사유 | `군복무 제외` |
| `status` | 상태 | `대기` / `승인` / `거부` |
| `applied_at` | 반영 일시 | (승인 시 자동) |

### 학습 가능 필드

| 필드 | 학습 가능 | 이유 |
|------|----------|------|
| `name` | ❌ | PII, 정규식으로 충분 |
| `phone` | ❌ | PII, 정규식으로 충분 |
| `email` | ❌ | PII, 정규식으로 충분 |
| `exp_years` | ✅ | 객관적 검증 가능 |
| `current_company` | ✅ | 원본에서 확인 가능 |
| `current_position` | ✅ | 원본에서 확인 가능 |
| `careers` | ⚠️ 제한적 | 구조 변환 오류만 |
| `skills` | ⚠️ 제한적 | 누락된 스킬 추가만 |
| `summary` | ❌ | 주관적 |
| `strengths` | ❌ | 주관적 |

### 구현 항목

1. **DB 테이블 생성**
   - `corrections`: 수정 데이터 저장
   - `few_shot_examples`: 승인된 예시 저장

2. **수정 데이터 수집 API**
   - `POST /api/candidates/{id}/corrections`
   - 수정 시 자동 호출

3. **Google Sheets 동기화**
   - Service Account 설정
   - 배치 동기화 (1시간 단위 또는 실시간)

4. **승인 데이터 반영 트리거**
   - `POST /admin/corrections/sync`
   - Sheets에서 `status=승인` 인 것만 반영

5. **프롬프트 동적 생성**
   - `few_shot_examples` 테이블에서 예시 로드
   - LLM 호출 시 프롬프트에 삽입

### 필요 사항

- Google Service Account (Sheets API 접근용)
- 공유된 Google Sheets 스프레드시트 ID
- Supabase 테이블 마이그레이션

### 참고

- 관리자 대시보드 없이 Google Sheets로 검토/승인
- 트리거 API 호출로 반영
