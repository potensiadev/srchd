# RAI (Recruitment Asset Intelligence)
# ê¸°ìˆ  ì•„í‚¤í…ì²˜ & Claude Code ê°œë°œ ê°€ì´ë“œ v3.0

---

## ğŸ“‹ ë¬¸ì„œ ì •ë³´

| í•­ëª© | ë‚´ìš© |
|------|------|
| ë²„ì „ | v3.0 (Production Ready) |
| ìµœì¢… ìˆ˜ì • | 2025ë…„ 1ì›” |
| ì£¼ìš” ë³€ê²½ | HWP ìš°íšŒ, ê°œì¸ì •ë³´ ë™ì˜, 2-Phase Cross-Check, í”¼ë“œë°± ë£¨í”„ |

---

## ğŸ“Œ v3.0 ì£¼ìš” ë³€ê²½ì‚¬í•­

| í•­ëª© | v2.0 | v3.0 |
|------|------|------|
| HWP íŒŒì‹± | ì§ì ‘ íŒŒì‹±ë§Œ | **ì§ì ‘ íŒŒì‹± + PDF ë³€í™˜ ìš°íšŒ** |
| Phase 1 | GPT-4o ë‹¨ë… | **GPT-4o + Gemini 1.5 Pro** |
| Phase 2 | GPT-4o + Claude | **GPT-4o + Gemini + Claude (3ë‹¨ê³„)** |
| ê°œì¸ì •ë³´ ë™ì˜ | ì—†ìŒ | **íšŒì›ê°€ì… ì‹œ í•„ìˆ˜ ë™ì˜** |
| ê²°ê³¼ ê²€í†  | ì—†ìŒ | **í¸ì§‘ ê°€ëŠ¥ UI + ê²½ê³  í‘œì‹œ** |
| ê²€ìƒ‰ í”¼ë“œë°± | ì—†ìŒ | **"ê´€ë ¨ì—†ìŒ" í”¼ë“œë°± ë£¨í”„** |

---

# Part 1: Phase ì „ëµ (ìˆ˜ì •)

## 1.1 Cross-Check ì „ëµ ë³€ê²½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RAI Cross-Check ì „ëµ v3.0                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Phase 1: MVP (ì €ë¹„ìš© Cross-Check)                                â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚  â”‚
â”‚  â”‚    â”‚ GPT-4o  â”‚ â”€â”€â”¬â”€â”€â–¶  â”‚  ê²°ê³¼ ë¹„êµ      â”‚                        â”‚  â”‚
â”‚  â”‚    â”‚ (ë©”ì¸)  â”‚   â”‚     â”‚  (JSON Diff)    â”‚                        â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚  â”‚
â”‚  â”‚                  â”‚              â”‚                                  â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ ì¼ì¹˜ â†’ GPT ê²°ê³¼ ì±„íƒ             â”‚  â”‚
â”‚  â”‚    â”‚ Gemini 1.5 Pro  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”˜ ë¶ˆì¼ì¹˜ â†’ Gemini ê²°ê³¼ ìš°ì„         â”‚  â”‚
â”‚  â”‚    â”‚ (ê²€ì¦/ì €ë¹„ìš©)    â”‚           (GPTë³´ë‹¤ ì €ë ´)                   â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â€¢ ê±´ë‹¹ ë¹„ìš©: ~60-70ì›                                            â”‚  â”‚
â”‚  â”‚  â€¢ ì •í™•ë„: 96-97%                                                 â”‚  â”‚
â”‚  â”‚  â€¢ JSON ì•ˆì •ì„±: 100% (Structured Outputs)                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                           â”‚
â”‚                              â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Phase 2: Premium (3ë‹¨ê³„ Cross-Check)                             â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚  â”‚
â”‚  â”‚    â”‚ GPT-4o  â”‚ â”€â”€â”€â”€â”                                              â”‚  â”‚
â”‚  â”‚    â”‚ (ì°½ì˜ì )â”‚     â”‚                                              â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚  â”‚
â”‚  â”‚                    â”œâ”€â”€â–¶  â”‚  3-Way ë¹„êµ     â”‚                      â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                 â”‚                      â”‚  â”‚
â”‚  â”‚    â”‚ Gemini 1.5 Pro  â”‚â”€â”€â–¶â”‚  2/3 ì¼ì¹˜ ì‹œ   â”‚â”€â”€â–¶ ë‹¤ìˆ˜ê²° ì±„íƒ       â”‚  â”‚
â”‚  â”‚    â”‚ (ê· í˜•)          â”‚   â”‚  ì±„íƒ           â”‚                      â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                 â”‚                      â”‚  â”‚
â”‚  â”‚                    â”œâ”€â”€â–¶  â”‚  3ê°œ ëª¨ë‘ ë¶ˆì¼ì¹˜â”‚â”€â”€â–¶ Claude ê²°ê³¼ ìš°ì„   â”‚  â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  ì‹œ Claude ìš°ì„  â”‚    (ê°€ì¥ ì •ë°€)       â”‚  â”‚
â”‚  â”‚    â”‚ Claude 3.5      â”‚â”€â”€â”€â”˜                 â”‚                      â”‚  â”‚
â”‚  â”‚    â”‚ (ì •ë°€ ì¶”ì¶œ)     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚  â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚  â”‚
â”‚  â”‚                                                                    â”‚  â”‚
â”‚  â”‚  â€¢ ê±´ë‹¹ ë¹„ìš©: ~150-180ì›                                          â”‚  â”‚
â”‚  â”‚  â€¢ ì •í™•ë„: 98-99%                                                 â”‚  â”‚
â”‚  â”‚  â€¢ Enterprise í”Œëœ ì „ìš©                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1.2 Phaseë³„ ë¹„ìš© ë¶„ì„

### Phase 1 ë¹„ìš© (GPT-4o + Gemini 1.5 Pro)

| ëª¨ë¸ | Input | Output | í† í° | ë¹„ìš© |
|------|-------|--------|------|------|
| GPT-4o | $5/1M | $15/1M | 5K+2K | ~$0.035 (~45ì›) |
| Gemini 1.5 Pro | $1.25/1M | $5/1M | 5K+2K | ~$0.016 (~20ì›) |
| Embedding | $0.02/1M | - | 2K | ~$0.0001 (~0.1ì›) |
| **í•©ê³„** | | | | **~65ì›/ê±´** |

### Phase 2 ë¹„ìš© (+ Claude 3.5 Sonnet)

| ëª¨ë¸ | Input | Output | í† í° | ë¹„ìš© |
|------|-------|--------|------|------|
| GPT-4o | $5/1M | $15/1M | 5K+2K | ~$0.035 |
| Gemini 1.5 Pro | $1.25/1M | $5/1M | 5K+2K | ~$0.016 |
| Claude 3.5 Sonnet | $3/1M | $15/1M | 5K+2K | ~$0.045 |
| Embedding | $0.02/1M | - | 2K | ~$0.0001 |
| **í•©ê³„** | | | | **~$0.096 (~125ì›)/ê±´** |

### ìš”ê¸ˆì œë³„ ë§ˆì§„ ë¶„ì„

| í”Œëœ | ì›” ìš”ê¸ˆ | í¬ë ˆë”§ | ì²˜ë¦¬ ë¹„ìš© (Phase 1) | ë§ˆì§„ìœ¨ |
|------|---------|--------|---------------------|--------|
| Starter | 79,000ì› | 50ê±´ | 3,250ì› | **96%** |
| Pro | 149,000ì› | 150ê±´ | 9,750ì› | **93%** |
| Enterprise | 199,000ì› | 300ê±´ (Phase 2) | 37,500ì› | **81%** |

---

# Part 2: HWP íŒŒì‹± + PDF ë³€í™˜ ìš°íšŒ

## 2.1 HWP ì²˜ë¦¬ ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HWP íŒŒì‹± Fallback ì „ëµ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  HWP íŒŒì¼ ì—…ë¡œë“œ                                                         â”‚
â”‚       â”‚                                                                  â”‚
â”‚       â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚  1ì°¨ ì‹œë„: ì§ì ‘ íŒŒì‹± (olefile)          â”‚                            â”‚
â”‚  â”‚  â€¢ ì†ë„: ë¹ ë¦„ (1-2ì´ˆ)                   â”‚                            â”‚
â”‚  â”‚  â€¢ ë¹„ìš©: 0ì›                            â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                   â”‚                                                      â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚           â–¼               â–¼                                             â”‚
â”‚       ì„±ê³µ âœ…          ì‹¤íŒ¨ âŒ                                           â”‚
â”‚       (í…ìŠ¤íŠ¸ ì¶”ì¶œ)    (íŒŒì‹± ì—ëŸ¬ or í…ìŠ¤íŠ¸ 100ì ë¯¸ë§Œ)                   â”‚
â”‚           â”‚               â”‚                                             â”‚
â”‚           â”‚               â–¼                                             â”‚
â”‚           â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚           â”‚   â”‚  2ì°¨ ì‹œë„: LibreOffice ë³€í™˜              â”‚               â”‚
â”‚           â”‚   â”‚  HWP â†’ PDF â†’ í…ìŠ¤íŠ¸ ì¶”ì¶œ                â”‚               â”‚
â”‚           â”‚   â”‚  â€¢ ì†ë„: ëŠë¦¼ (5-10ì´ˆ)                  â”‚               â”‚
â”‚           â”‚   â”‚  â€¢ ë¹„ìš©: 0ì›                            â”‚               â”‚
â”‚           â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚           â”‚                    â”‚                                        â”‚
â”‚           â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚           â”‚            â–¼               â–¼                                â”‚
â”‚           â”‚        ì„±ê³µ âœ…          ì‹¤íŒ¨ âŒ                              â”‚
â”‚           â”‚        (PDF ì¶”ì¶œ)      (ë³€í™˜ ì‹¤íŒ¨)                           â”‚
â”‚           â”‚            â”‚               â”‚                                â”‚
â”‚           â”‚            â”‚               â–¼                                â”‚
â”‚           â”‚            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚           â”‚            â”‚   â”‚  3ì°¨ ì‹œë„: í•œì»´ API (ìœ ë£Œ ë°±ì—…)      â”‚      â”‚
â”‚           â”‚            â”‚   â”‚  â€¢ ë¹„ìš©: ê±´ë‹¹ ~50ì›                 â”‚      â”‚
â”‚           â”‚            â”‚   â”‚  â€¢ ë˜ëŠ”: ìˆ˜ë™ ì…ë ¥ ìœ ë„             â”‚      â”‚
â”‚           â”‚            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚            â”‚                    â”‚                           â”‚
â”‚           â–¼            â–¼                    â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Parser Agentë¡œ ì „ë‹¬                          â”‚    â”‚
â”‚  â”‚                    (raw_text + parse_method ë©”íƒ€ë°ì´í„°)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2.2 HWP Parser êµ¬í˜„ (Fallback í¬í•¨)

```python
# apps/worker/utils/hwp_parser.py

"""
HWP íŒŒì¼ íŒŒì„œ - Fallback ì „ëµ í¬í•¨
1ì°¨: ì§ì ‘ íŒŒì‹± (olefile)
2ì°¨: LibreOffice ë³€í™˜ (HWP â†’ PDF)
3ì°¨: í•œì»´ API (ì˜µì…˜) ë˜ëŠ” ìˆ˜ë™ ì…ë ¥ ìœ ë„
"""

import io
import os
import tempfile
import subprocess
import zipfile
import struct
import zlib
from typing import Tuple, Optional
from enum import Enum
from dataclasses import dataclass

import olefile
from bs4 import BeautifulSoup


class ParseMethod(str, Enum):
    DIRECT = "direct"           # ì§ì ‘ íŒŒì‹± ì„±ê³µ
    LIBREOFFICE = "libreoffice" # LibreOffice ë³€í™˜ í›„ íŒŒì‹±
    HANCOM_API = "hancom_api"   # í•œì»´ API ì‚¬ìš© (ìœ ë£Œ)
    FAILED = "failed"           # ëª¨ë“  ë°©ë²• ì‹¤íŒ¨


@dataclass
class HWPParseResult:
    text: str
    method: ParseMethod
    page_count: int
    is_encrypted: bool
    error_message: Optional[str] = None


class HWPParser:
    """HWP/HWPX íŒŒì¼ íŒŒì„œ (Fallback ì „ëµ í¬í•¨)"""
    
    # ìµœì†Œ ìœ íš¨ í…ìŠ¤íŠ¸ ê¸¸ì´ (ì´í•˜ë©´ íŒŒì‹± ì‹¤íŒ¨ë¡œ ê°„ì£¼)
    MIN_TEXT_LENGTH = 100
    
    def __init__(self, hancom_api_key: Optional[str] = None):
        self.hancom_api_key = hancom_api_key
    
    def parse(self, file_bytes: bytes, filename: str = "document.hwp") -> HWPParseResult:
        """
        HWP íŒŒì¼ íŒŒì‹± (Fallback ì „ëµ ì ìš©)
        
        Returns:
            HWPParseResult ê°ì²´
        """
        # ì•”í˜¸í™” ì²´í¬
        is_encrypted = self.is_encrypted(file_bytes)
        if is_encrypted:
            return HWPParseResult(
                text="",
                method=ParseMethod.FAILED,
                page_count=0,
                is_encrypted=True,
                error_message="DRM_PROTECTED: ì•”í˜¸í™”ëœ HWP íŒŒì¼ì…ë‹ˆë‹¤."
            )
        
        # íŒŒì¼ íƒ€ì… ê°ì§€
        is_hwpx = file_bytes[:4] == b'PK\x03\x04'
        
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # 1ì°¨ ì‹œë„: ì§ì ‘ íŒŒì‹±
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        try:
            if is_hwpx:
                text, page_count = self._parse_hwpx_direct(file_bytes)
            else:
                text, page_count = self._parse_hwp_direct(file_bytes)
            
            if text and len(text.strip()) >= self.MIN_TEXT_LENGTH:
                return HWPParseResult(
                    text=text,
                    method=ParseMethod.DIRECT,
                    page_count=page_count,
                    is_encrypted=False
                )
        except Exception as e:
            pass  # 1ì°¨ ì‹¤íŒ¨, 2ì°¨ë¡œ ì§„í–‰
        
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # 2ì°¨ ì‹œë„: LibreOffice ë³€í™˜ (HWP â†’ PDF â†’ Text)
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        try:
            text, page_count = self._parse_via_libreoffice(file_bytes, filename)
            
            if text and len(text.strip()) >= self.MIN_TEXT_LENGTH:
                return HWPParseResult(
                    text=text,
                    method=ParseMethod.LIBREOFFICE,
                    page_count=page_count,
                    is_encrypted=False
                )
        except Exception as e:
            pass  # 2ì°¨ ì‹¤íŒ¨, 3ì°¨ë¡œ ì§„í–‰
        
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # 3ì°¨ ì‹œë„: í•œì»´ API (ì„¤ì •ëœ ê²½ìš°ë§Œ)
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if self.hancom_api_key:
            try:
                text, page_count = self._parse_via_hancom_api(file_bytes)
                
                if text and len(text.strip()) >= self.MIN_TEXT_LENGTH:
                    return HWPParseResult(
                        text=text,
                        method=ParseMethod.HANCOM_API,
                        page_count=page_count,
                        is_encrypted=False
                    )
            except Exception as e:
                pass
        
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # ëª¨ë“  ë°©ë²• ì‹¤íŒ¨
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        return HWPParseResult(
            text="",
            method=ParseMethod.FAILED,
            page_count=0,
            is_encrypted=False,
            error_message="HWP_PARSE_FAILED: íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. PDFë¡œ ë³€í™˜ í›„ ë‹¤ì‹œ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”."
        )
    
    def _parse_hwpx_direct(self, file_bytes: bytes) -> Tuple[str, int]:
        """HWPX ì§ì ‘ íŒŒì‹±"""
        texts = []
        page_count = 0
        
        with zipfile.ZipFile(io.BytesIO(file_bytes)) as zf:
            section_files = sorted([
                f for f in zf.namelist()
                if f.startswith('Contents/section') and f.endswith('.xml')
            ])
            
            page_count = len(section_files) or 1
            
            for section_file in section_files:
                with zf.open(section_file) as f:
                    soup = BeautifulSoup(f.read(), 'xml')
                    for text_elem in soup.find_all('hp:t'):
                        if text_elem.string:
                            texts.append(text_elem.string)
        
        return '\n'.join(texts), page_count
    
    def _parse_hwp_direct(self, file_bytes: bytes) -> Tuple[str, int]:
        """HWP (OLE) ì§ì ‘ íŒŒì‹±"""
        texts = []
        page_count = 1
        
        ole = olefile.OleFileIO(io.BytesIO(file_bytes))
        
        try:
            if ole.exists('BodyText'):
                body_streams = [
                    entry for entry in ole.listdir()
                    if entry[0] == 'BodyText'
                ]
                
                for stream_path in body_streams:
                    stream_name = '/'.join(stream_path)
                    data = ole.openstream(stream_name).read()
                    
                    # ì••ì¶• í•´ì œ ì‹œë„
                    try:
                        decompressed = zlib.decompress(data, -15)
                        text = self._extract_text_from_bodytext(decompressed)
                    except zlib.error:
                        text = self._extract_text_from_bodytext(data)
                    
                    if text:
                        texts.append(text)
        finally:
            ole.close()
        
        return '\n'.join(texts), page_count
    
    def _extract_text_from_bodytext(self, data: bytes) -> str:
        """BodyText ë°”ì´ë„ˆë¦¬ì—ì„œ í…ìŠ¤íŠ¸ ì¶”ì¶œ"""
        texts = []
        i = 0
        
        while i < len(data):
            if i + 4 > len(data):
                break
            
            header = struct.unpack('<I', data[i:i+4])[0]
            tag_id = header & 0x3FF
            size = (header >> 20) & 0xFFF
            
            if size == 0xFFF:
                if i + 8 > len(data):
                    break
                size = struct.unpack('<I', data[i+4:i+8])[0]
                i += 8
            else:
                i += 4
            
            # PARA_TEXT (tag_id == 67)
            if tag_id == 67 and i + size <= len(data):
                record_data = data[i:i+size]
                try:
                    text = record_data.decode('utf-16le', errors='ignore')
                    text = ''.join(c for c in text if c.isprintable() or c in '\n\t ')
                    if text.strip():
                        texts.append(text.strip())
                except:
                    pass
            
            i += size
        
        return '\n'.join(texts)
    
    def _parse_via_libreoffice(self, file_bytes: bytes, filename: str) -> Tuple[str, int]:
        """
        LibreOfficeë¡œ HWP â†’ PDF ë³€í™˜ í›„ í…ìŠ¤íŠ¸ ì¶”ì¶œ
        
        Requirements:
        - LibreOffice ì„¤ì¹˜ í•„ìš”
        - Ubuntu: apt-get install libreoffice
        - í•œê¸€ ì§€ì›: apt-get install fonts-nanum
        """
        from .pdf_parser import PDFParser
        
        # ì„ì‹œ íŒŒì¼ë¡œ ì €ì¥
        with tempfile.NamedTemporaryFile(suffix='.hwp', delete=False) as tmp_hwp:
            tmp_hwp.write(file_bytes)
            hwp_path = tmp_hwp.name
        
        try:
            with tempfile.TemporaryDirectory() as tmp_dir:
                # LibreOfficeë¡œ PDF ë³€í™˜
                result = subprocess.run([
                    'libreoffice',
                    '--headless',
                    '--invisible',
                    '--convert-to', 'pdf',
                    '--outdir', tmp_dir,
                    hwp_path
                ], capture_output=True, timeout=60)
                
                if result.returncode != 0:
                    raise Exception(f"LibreOffice conversion failed: {result.stderr.decode()}")
                
                # ë³€í™˜ëœ PDF ì°¾ê¸°
                pdf_filename = os.path.basename(hwp_path).rsplit('.', 1)[0] + '.pdf'
                pdf_path = os.path.join(tmp_dir, pdf_filename)
                
                if not os.path.exists(pdf_path):
                    raise Exception("PDF file not created")
                
                # PDFì—ì„œ í…ìŠ¤íŠ¸ ì¶”ì¶œ
                with open(pdf_path, 'rb') as f:
                    pdf_bytes = f.read()
                
                text, meta = PDFParser.parse(pdf_bytes, enable_ocr=True)
                return text, meta.get('page_count', 1)
        
        finally:
            os.unlink(hwp_path)
    
    def _parse_via_hancom_api(self, file_bytes: bytes) -> Tuple[str, int]:
        """
        í•œì»´ ê³µì‹ APIë¡œ í…ìŠ¤íŠ¸ ì¶”ì¶œ (ìœ ë£Œ)
        
        í•œì»´ API ë¬¸ì„œ: https://developer.hancom.com/
        ê±´ë‹¹ ì•½ 50ì› ì˜ˆìƒ
        """
        import httpx
        
        # í•œì»´ API í˜¸ì¶œ (ì‹¤ì œ API ìŠ¤í™ì— ë§ê²Œ ìˆ˜ì • í•„ìš”)
        response = httpx.post(
            "https://api.hancom.com/v1/convert/text",
            headers={"Authorization": f"Bearer {self.hancom_api_key}"},
            files={"file": ("document.hwp", file_bytes)},
            timeout=60
        )
        
        if response.status_code != 200:
            raise Exception(f"Hancom API error: {response.text}")
        
        result = response.json()
        return result.get("text", ""), result.get("page_count", 1)
    
    def is_encrypted(self, file_bytes: bytes) -> bool:
        """ì•”í˜¸í™” ì—¬ë¶€ ì²´í¬"""
        if file_bytes[:4] == b'PK\x03\x04':
            # HWPX
            try:
                with zipfile.ZipFile(io.BytesIO(file_bytes)) as zf:
                    return 'Contents/' not in str(zf.namelist())
            except:
                return True
        
        elif file_bytes[:4] == b'\xD0\xCF\x11\xE0':
            # HWP (OLE)
            try:
                ole = olefile.OleFileIO(io.BytesIO(file_bytes))
                if ole.exists('FileHeader'):
                    header = ole.openstream('FileHeader').read()
                    if len(header) > 39:
                        flags = struct.unpack('<I', header[36:40])[0]
                        return (flags & 0x02) != 0
                ole.close()
            except:
                return True
        
        return False
    
    @staticmethod
    def get_parse_method_display(method: ParseMethod) -> str:
        """íŒŒì‹± ë°©ë²• í‘œì‹œìš© ë¬¸ìì—´"""
        return {
            ParseMethod.DIRECT: "ì§ì ‘ íŒŒì‹±",
            ParseMethod.LIBREOFFICE: "PDF ë³€í™˜",
            ParseMethod.HANCOM_API: "í•œì»´ API",
            ParseMethod.FAILED: "íŒŒì‹± ì‹¤íŒ¨"
        }.get(method, "ì•Œ ìˆ˜ ì—†ìŒ")
```

## 2.3 Worker Dockerfile (LibreOffice í¬í•¨)

```dockerfile
# apps/worker/Dockerfile

FROM python:3.11-slim

# ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apt-get update && apt-get install -y \
    # LibreOffice (HWP â†’ PDF ë³€í™˜)
    libreoffice \
    # í•œê¸€ í°íŠ¸
    fonts-nanum \
    fonts-nanum-coding \
    # OpenCV ì˜ì¡´ì„±
    libgl1-mesa-glx \
    libglib2.0-0 \
    # PDF ì²˜ë¦¬
    poppler-utils \
    # OCR
    tesseract-ocr \
    tesseract-ocr-kor \
    # antiword (DOC íŒŒì‹±)
    antiword \
    # ê¸°íƒ€
    && rm -rf /var/lib/apt/lists/*

# Playwright ë¸Œë¼ìš°ì € ì„¤ì¹˜
RUN pip install playwright && playwright install chromium --with-deps

# ì‘ì—… ë””ë ‰í† ë¦¬
WORKDIR /app

# ì˜ì¡´ì„± ì„¤ì¹˜
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# ì†ŒìŠ¤ ë³µì‚¬
COPY . .

# í™˜ê²½ ë³€ìˆ˜
ENV PYTHONUNBUFFERED=1

# ì‹¤í–‰
CMD ["python", "main.py"]
```

---

# Part 3: íšŒì›ê°€ì… + ê°œì¸ì •ë³´ ë™ì˜ í”„ë¡œì„¸ìŠ¤

## 3.1 ë™ì˜ í”„ë¡œì„¸ìŠ¤ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    íšŒì›ê°€ì…/ë¡œê·¸ì¸ + ê°œì¸ì •ë³´ ë™ì˜ í”Œë¡œìš°                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  1. ëœë”© í˜ì´ì§€                                                  â”‚    â”‚
â”‚  â”‚     [ë¬´ë£Œ ì‹œì‘í•˜ê¸°] ë²„íŠ¼                                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                          â”‚
â”‚                               â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  2. íšŒì›ê°€ì…/ë¡œê·¸ì¸ ì„ íƒ                                         â”‚    â”‚
â”‚  â”‚     â€¢ Google ì†Œì…œ ë¡œê·¸ì¸                                         â”‚    â”‚
â”‚  â”‚     â€¢ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸                                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                          â”‚
â”‚                               â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  3. í•„ìˆ˜ ë™ì˜ í™”ë©´ (ì‹ ê·œ ê°€ì… ì‹œ)                                 â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â˜ [í•„ìˆ˜] ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜                [ì „ë¬¸ ë³´ê¸°]        â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â˜ [í•„ìˆ˜] ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ ë™ì˜              [ì „ë¬¸ ë³´ê¸°]        â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â˜ [í•„ìˆ˜] ì œ3ì ê°œì¸ì •ë³´ ì²˜ë¦¬ ë³´ì¦ ë™ì˜       [ì „ë¬¸ ë³´ê¸°]        â”‚    â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚     â”‚ ë³¸ì¸ì€ ë³¸ ì„œë¹„ìŠ¤ì— ì—…ë¡œë“œí•˜ëŠ” ì´ë ¥ì„œ ë° ê°œì¸ì •ë³´ì—   â”‚     â”‚    â”‚
â”‚  â”‚     â”‚ ëŒ€í•´ ì •ë³´ì£¼ì²´(í›„ë³´ì)ë¡œë¶€í„° ì ë²•í•œ ë™ì˜ë¥¼ ë°›ì•˜ìŒì„   â”‚     â”‚    â”‚
â”‚  â”‚     â”‚ ë³´ì¦í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„ë°˜í•˜ì—¬ ë°œìƒí•˜ëŠ” ëª¨ë“  ë²•ì  ì±…ì„ì€  â”‚     â”‚    â”‚
â”‚  â”‚     â”‚ ë³¸ì¸ì—ê²Œ ìˆìŒì„ í™•ì¸í•©ë‹ˆë‹¤.                         â”‚     â”‚    â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚                                   â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚            [ëª¨ë‘ ë™ì˜í•˜ê³  ì‹œì‘í•˜ê¸°]                      â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â€» í•„ìˆ˜ í•­ëª©ì— ë™ì˜í•˜ì§€ ì•Šìœ¼ë©´ ì„œë¹„ìŠ¤ ì´ìš©ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                          â”‚
â”‚                               â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  4. ëŒ€ì‹œë³´ë“œ ì§„ì…                                                â”‚    â”‚
â”‚  â”‚     â€¢ í™˜ì˜ ëª¨ë‹¬ (ì‚¬ìš© ê°€ì´ë“œ)                                    â”‚    â”‚
â”‚  â”‚     â€¢ ì²« ì—…ë¡œë“œ ìœ ë„                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3.2 DB ìŠ¤í‚¤ë§ˆ (ë™ì˜ ê¸°ë¡)

```sql
-- ì‚¬ìš©ì ë™ì˜ ê¸°ë¡ í…Œì´ë¸”
CREATE TABLE user_consents (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- ë™ì˜ í•­ëª©
    terms_of_service BOOLEAN DEFAULT false,          -- ì´ìš©ì•½ê´€
    terms_of_service_version TEXT,                   -- ì•½ê´€ ë²„ì „
    terms_of_service_agreed_at TIMESTAMPTZ,
    
    privacy_policy BOOLEAN DEFAULT false,            -- ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨
    privacy_policy_version TEXT,
    privacy_policy_agreed_at TIMESTAMPTZ,
    
    third_party_data_guarantee BOOLEAN DEFAULT false, -- ì œ3ì ì •ë³´ ë³´ì¦ â­
    third_party_data_guarantee_version TEXT,
    third_party_data_guarantee_agreed_at TIMESTAMPTZ,
    
    marketing_consent BOOLEAN DEFAULT false,         -- ë§ˆì¼€íŒ… (ì„ íƒ)
    marketing_consent_agreed_at TIMESTAMPTZ,
    
    -- ë©”íƒ€
    ip_address TEXT,
    user_agent TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- users í…Œì´ë¸”ì— ë™ì˜ ì™„ë£Œ í”Œë˜ê·¸ ì¶”ê°€
ALTER TABLE users ADD COLUMN consents_completed BOOLEAN DEFAULT false;
ALTER TABLE users ADD COLUMN consents_completed_at TIMESTAMPTZ;

-- RLS
ALTER TABLE user_consents ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own consents"
ON user_consents FOR SELECT
USING (user_id = auth.uid());

CREATE POLICY "Users can insert own consents"
ON user_consents FOR INSERT
WITH CHECK (user_id = auth.uid());
```

## 3.3 ë™ì˜ í™”ë©´ ì»´í¬ë„ŒíŠ¸

```typescript
// apps/web/components/features/auth/consent-form.tsx

"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { createClientComponentClient } from "@supabase/auth-helpers-nextjs";
import { Checkbox } from "@/components/ui/checkbox";
import { Button } from "@/components/ui/button";
import { 
  Dialog, 
  DialogContent, 
  DialogHeader, 
  DialogTitle 
} from "@/components/ui/dialog";
import { ScrollArea } from "@/components/ui/scroll-area";
import { AlertCircle, FileText, Shield, Users } from "lucide-react";

interface ConsentFormProps {
  userId: string;
  onComplete: () => void;
}

// ì•½ê´€ ë²„ì „ ê´€ë¦¬
const CONSENT_VERSIONS = {
  terms: "2025.01.01",
  privacy: "2025.01.01",
  thirdParty: "2025.01.01",
};

export function ConsentForm({ userId, onComplete }: ConsentFormProps) {
  const router = useRouter();
  const supabase = createClientComponentClient();
  
  const [consents, setConsents] = useState({
    terms: false,
    privacy: false,
    thirdParty: false,
    marketing: false,
  });
  
  const [viewingDoc, setViewingDoc] = useState<string | null>(null);
  const [isSubmitting, setIsSubmitting] = useState(false);
  
  const allRequiredChecked = 
    consents.terms && consents.privacy && consents.thirdParty;
  
  const handleCheckAll = () => {
    const newValue = !allRequiredChecked;
    setConsents({
      terms: newValue,
      privacy: newValue,
      thirdParty: newValue,
      marketing: newValue,
    });
  };
  
  const handleSubmit = async () => {
    if (!allRequiredChecked) return;
    
    setIsSubmitting(true);
    
    try {
      const now = new Date().toISOString();
      
      // ë™ì˜ ê¸°ë¡ ì €ì¥
      await supabase.from("user_consents").insert({
        user_id: userId,
        terms_of_service: true,
        terms_of_service_version: CONSENT_VERSIONS.terms,
        terms_of_service_agreed_at: now,
        privacy_policy: true,
        privacy_policy_version: CONSENT_VERSIONS.privacy,
        privacy_policy_agreed_at: now,
        third_party_data_guarantee: true,
        third_party_data_guarantee_version: CONSENT_VERSIONS.thirdParty,
        third_party_data_guarantee_agreed_at: now,
        marketing_consent: consents.marketing,
        marketing_consent_agreed_at: consents.marketing ? now : null,
      });
      
      // ì‚¬ìš©ì ë™ì˜ ì™„ë£Œ í”Œë˜ê·¸ ì—…ë°ì´íŠ¸
      await supabase.from("users").update({
        consents_completed: true,
        consents_completed_at: now,
      }).eq("id", userId);
      
      onComplete();
    } catch (error) {
      console.error("Consent submission error:", error);
    } finally {
      setIsSubmitting(false);
    }
  };
  
  return (
    <div className="max-w-lg mx-auto p-6 space-y-6">
      <div className="text-center space-y-2">
        <Shield className="w-12 h-12 mx-auto text-primary" />
        <h1 className="text-2xl font-bold">ì„œë¹„ìŠ¤ ì´ìš© ë™ì˜</h1>
        <p className="text-muted-foreground">
          HR Screener ì„œë¹„ìŠ¤ ì´ìš©ì„ ìœ„í•´ ì•„ë˜ ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.
        </p>
      </div>
      
      {/* ì „ì²´ ë™ì˜ */}
      <div className="p-4 bg-muted rounded-lg">
        <label className="flex items-center gap-3 cursor-pointer">
          <Checkbox
            checked={allRequiredChecked && consents.marketing}
            onCheckedChange={handleCheckAll}
          />
          <span className="font-medium">ëª¨ë‘ ë™ì˜í•©ë‹ˆë‹¤</span>
        </label>
      </div>
      
      <div className="space-y-4">
        {/* ì´ìš©ì•½ê´€ */}
        <ConsentItem
          icon={<FileText className="w-5 h-5" />}
          label="ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€"
          required
          checked={consents.terms}
          onCheckedChange={(v) => setConsents({ ...consents, terms: v })}
          onViewClick={() => setViewingDoc("terms")}
        />
        
        {/* ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ */}
        <ConsentItem
          icon={<Shield className="w-5 h-5" />}
          label="ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨"
          required
          checked={consents.privacy}
          onCheckedChange={(v) => setConsents({ ...consents, privacy: v })}
          onViewClick={() => setViewingDoc("privacy")}
        />
        
        {/* â­ ì œ3ì ì •ë³´ ë³´ì¦ (í•µì‹¬) */}
        <div className="border-2 border-primary/50 rounded-lg p-4 space-y-3">
          <ConsentItem
            icon={<Users className="w-5 h-5" />}
            label="ì œ3ì ê°œì¸ì •ë³´ ì²˜ë¦¬ ë³´ì¦"
            required
            checked={consents.thirdParty}
            onCheckedChange={(v) => setConsents({ ...consents, thirdParty: v })}
            onViewClick={() => setViewingDoc("thirdParty")}
          />
          
          <div className="bg-amber-50 border border-amber-200 rounded-md p-3 text-sm">
            <div className="flex gap-2">
              <AlertCircle className="w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5" />
              <div className="text-amber-800">
                <p className="font-medium">ì¤‘ìš” ì•ˆë‚´</p>
                <p className="mt-1">
                  ë³¸ì¸ì€ ì„œë¹„ìŠ¤ì— ì—…ë¡œë“œí•˜ëŠ” ì´ë ¥ì„œì˜ ì •ë³´ì£¼ì²´(í›„ë³´ì)ë¡œë¶€í„° 
                  <strong> ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ëŒ€í•œ ì ë²•í•œ ë™ì˜</strong>ë¥¼ ë°›ì•˜ìŒì„ 
                  ë³´ì¦í•©ë‹ˆë‹¤.
                </p>
                <p className="mt-1 text-amber-700">
                  ì´ë¥¼ ìœ„ë°˜í•˜ì—¬ ë°œìƒí•˜ëŠ” ë²•ì  ì±…ì„ì€ ì‚¬ìš©ì ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤.
                </p>
              </div>
            </div>
          </div>
        </div>
        
        {/* ë§ˆì¼€íŒ… ë™ì˜ (ì„ íƒ) */}
        <ConsentItem
          icon={<FileText className="w-5 h-5" />}
          label="ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹ "
          required={false}
          checked={consents.marketing}
          onCheckedChange={(v) => setConsents({ ...consents, marketing: v })}
        />
      </div>
      
      <Button
        className="w-full"
        size="lg"
        disabled={!allRequiredChecked || isSubmitting}
        onClick={handleSubmit}
      >
        {isSubmitting ? "ì²˜ë¦¬ ì¤‘..." : "ë™ì˜í•˜ê³  ì‹œì‘í•˜ê¸°"}
      </Button>
      
      <p className="text-xs text-center text-muted-foreground">
        í•„ìˆ˜ í•­ëª©ì— ë™ì˜í•˜ì§€ ì•Šìœ¼ë©´ ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë©ë‹ˆë‹¤.
      </p>
      
      {/* ì•½ê´€ ì „ë¬¸ ë³´ê¸° ëª¨ë‹¬ */}
      <ConsentDocumentModal
        type={viewingDoc}
        onClose={() => setViewingDoc(null)}
      />
    </div>
  );
}

// ê°œë³„ ë™ì˜ í•­ëª© ì»´í¬ë„ŒíŠ¸
function ConsentItem({
  icon,
  label,
  required,
  checked,
  onCheckedChange,
  onViewClick,
}: {
  icon: React.ReactNode;
  label: string;
  required: boolean;
  checked: boolean;
  onCheckedChange: (checked: boolean) => void;
  onViewClick?: () => void;
}) {
  return (
    <div className="flex items-center justify-between p-3 border rounded-lg">
      <label className="flex items-center gap-3 cursor-pointer flex-1">
        <Checkbox checked={checked} onCheckedChange={onCheckedChange} />
        <span className="flex items-center gap-2">
          {icon}
          <span>
            {required && <span className="text-red-500">[í•„ìˆ˜] </span>}
            {!required && <span className="text-muted-foreground">[ì„ íƒ] </span>}
            {label}
          </span>
        </span>
      </label>
      {onViewClick && (
        <Button variant="ghost" size="sm" onClick={onViewClick}>
          ì „ë¬¸ ë³´ê¸°
        </Button>
      )}
    </div>
  );
}

// ì•½ê´€ ì „ë¬¸ ëª¨ë‹¬
function ConsentDocumentModal({
  type,
  onClose,
}: {
  type: string | null;
  onClose: () => void;
}) {
  const titles: Record<string, string> = {
    terms: "ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€",
    privacy: "ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨",
    thirdParty: "ì œ3ì ê°œì¸ì •ë³´ ì²˜ë¦¬ ë³´ì¦ ì•½ê´€",
  };
  
  return (
    <Dialog open={!!type} onOpenChange={() => onClose()}>
      <DialogContent className="max-w-2xl max-h-[80vh]">
        <DialogHeader>
          <DialogTitle>{type && titles[type]}</DialogTitle>
        </DialogHeader>
        <ScrollArea className="h-[60vh] pr-4">
          {type === "thirdParty" && <ThirdPartyGuaranteeContent />}
          {type === "terms" && <TermsOfServiceContent />}
          {type === "privacy" && <PrivacyPolicyContent />}
        </ScrollArea>
      </DialogContent>
    </Dialog>
  );
}

// ì œ3ì ì •ë³´ ë³´ì¦ ì•½ê´€ ë‚´ìš©
function ThirdPartyGuaranteeContent() {
  return (
    <div className="prose prose-sm max-w-none">
      <h3>ì œ3ì ê°œì¸ì •ë³´ ì²˜ë¦¬ ë³´ì¦ ì•½ê´€</h3>
      
      <p><strong>ì‹œí–‰ì¼:</strong> 2025ë…„ 1ì›” 1ì¼</p>
      
      <h4>ì œ1ì¡° (ëª©ì )</h4>
      <p>
        ë³¸ ì•½ê´€ì€ HR Screener ì„œë¹„ìŠ¤(ì´í•˜ "ì„œë¹„ìŠ¤")ë¥¼ ì´ìš©í•˜ì—¬ ì œ3ì(ì±„ìš© í›„ë³´ì)ì˜ 
        ê°œì¸ì •ë³´ê°€ í¬í•¨ëœ ì´ë ¥ì„œë¥¼ ì—…ë¡œë“œí•˜ê³  ì²˜ë¦¬í•˜ëŠ” ê³¼ì •ì—ì„œ ì‚¬ìš©ìì˜ ì±…ì„ê³¼ 
        ì˜ë¬´ë¥¼ ëª…í™•íˆ í•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.
      </p>
      
      <h4>ì œ2ì¡° (ì‚¬ìš©ìì˜ ë³´ì¦)</h4>
      <p>ì‚¬ìš©ìëŠ” ë‹¤ìŒ ì‚¬í•­ì„ ë³´ì¦í•©ë‹ˆë‹¤:</p>
      <ol>
        <li>
          ì„œë¹„ìŠ¤ì— ì—…ë¡œë“œí•˜ëŠ” ëª¨ë“  ì´ë ¥ì„œì— ëŒ€í•´, í•´ë‹¹ ì •ë³´ì£¼ì²´(í›„ë³´ì)ë¡œë¶€í„° 
          ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ëŒ€í•œ <strong>ëª…ì‹œì ì¸ ë™ì˜</strong>ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.
        </li>
        <li>
          ì •ë³´ì£¼ì²´ì—ê²Œ ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘ ëª©ì , í•­ëª©, ë³´ìœ  ê¸°ê°„ ë“± 
          ê°œì¸ì •ë³´ë³´í˜¸ë²•ì—ì„œ ìš”êµ¬í•˜ëŠ” ì‚¬í•­ì„ ê³ ì§€í•˜ì˜€ìŠµë‹ˆë‹¤.
        </li>
        <li>
          ì •ë³´ì£¼ì²´ëŠ” ìì‹ ì˜ ê°œì¸ì •ë³´ê°€ AI ê¸°ë°˜ ë¶„ì„ ë° ë°ì´í„°ë² ì´ìŠ¤í™”ë˜ëŠ” ê²ƒì— 
          ë™ì˜í•˜ì˜€ìŠµë‹ˆë‹¤.
        </li>
      </ol>
      
      <h4>ì œ3ì¡° (ì‚¬ìš©ìì˜ ì±…ì„)</h4>
      <p>
        ì‚¬ìš©ìê°€ ë³¸ ì•½ê´€ì˜ ë³´ì¦ ì‚¬í•­ì„ ìœ„ë°˜í•˜ì—¬ ë°œìƒí•˜ëŠ” ëª¨ë“  ë²•ì  ë¶„ìŸ, ì†í•´ë°°ìƒ, 
        ê³¼íƒœë£Œ, í–‰ì •ì²˜ë¶„ ë“±ì— ëŒ€í•œ ì±…ì„ì€ ì „ì ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ìˆìœ¼ë©°, íšŒì‚¬ëŠ” ì´ì— 
        ëŒ€í•´ ì±…ì„ì„ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </p>
      
      <h4>ì œ4ì¡° (íšŒì‚¬ì˜ ì—­í• )</h4>
      <p>íšŒì‚¬ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ê°œì¸ì •ë³´ë¥¼ ë³´í˜¸í•©ë‹ˆë‹¤:</p>
      <ul>
        <li>ì—…ë¡œë“œëœ ì´ë ¥ì„œëŠ” ì‚¬ìš©ì ë³¸ì¸ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
        <li>ë¯¼ê°í•œ ì—°ë½ì²˜ ì •ë³´ëŠ” AES-256 ì•”í˜¸í™”í•˜ì—¬ ì €ì¥í•©ë‹ˆë‹¤.</li>
        <li>íšŒì‚¬ ì§ì›ë„ ì•”í˜¸í™”ëœ ê°œì¸ì •ë³´ ì›ë¬¸ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
      </ul>
      
      <h4>ì œ5ì¡° (ë™ì˜ ì² íšŒ ìš”ì²­ ì²˜ë¦¬)</h4>
      <p>
        ì •ë³´ì£¼ì²´ë¡œë¶€í„° ê°œì¸ì •ë³´ ì‚­ì œ ìš”ì²­ì„ ë°›ì€ ê²½ìš°, ì‚¬ìš©ìëŠ” ì¦‰ì‹œ í•´ë‹¹ 
        í›„ë³´ìì˜ ì •ë³´ë¥¼ ì„œë¹„ìŠ¤ì—ì„œ ì‚­ì œí•´ì•¼ í•©ë‹ˆë‹¤.
      </p>
    </div>
  );
}

// ì´ìš©ì•½ê´€ (ê°„ëµ ë²„ì „ - ì‹¤ì œë¡œëŠ” ë²•ë¥  ê²€í†  í•„ìš”)
function TermsOfServiceContent() {
  return (
    <div className="prose prose-sm max-w-none">
      <h3>ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</h3>
      <p>HR Screener ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì…ë‹ˆë‹¤...</p>
      {/* ì‹¤ì œ ì•½ê´€ ë‚´ìš© */}
    </div>
  );
}

// ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ (ê°„ëµ ë²„ì „ - ì‹¤ì œë¡œëŠ” ë²•ë¥  ê²€í†  í•„ìš”)
function PrivacyPolicyContent() {
  return (
    <div className="prose prose-sm max-w-none">
      <h3>ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</h3>
      <p>HR Screener ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨ì…ë‹ˆë‹¤...</p>
      {/* ì‹¤ì œ ë°©ì¹¨ ë‚´ìš© */}
    </div>
  );
}
```

## 3.4 ë¯¸ë“¤ì›¨ì–´ (ë™ì˜ ì²´í¬)

```typescript
// apps/web/middleware.ts

import { createMiddlewareClient } from "@supabase/auth-helpers-nextjs";
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";

export async function middleware(req: NextRequest) {
  const res = NextResponse.next();
  const supabase = createMiddlewareClient({ req, res });
  
  const {
    data: { session },
  } = await supabase.auth.getSession();
  
  // ë³´í˜¸ëœ ê²½ë¡œ
  const protectedPaths = ["/dashboard", "/candidates", "/upload", "/search", "/settings"];
  const isProtectedPath = protectedPaths.some((path) =>
    req.nextUrl.pathname.startsWith(path)
  );
  
  // ë™ì˜ í˜ì´ì§€
  const isConsentPage = req.nextUrl.pathname === "/consent";
  
  if (isProtectedPath) {
    // ë¡œê·¸ì¸ ì•ˆ ë¨
    if (!session) {
      return NextResponse.redirect(new URL("/login", req.url));
    }
    
    // ë™ì˜ ì™„ë£Œ ì—¬ë¶€ ì²´í¬
    const { data: user } = await supabase
      .from("users")
      .select("consents_completed")
      .eq("id", session.user.id)
      .single();
    
    // ë™ì˜ ì•ˆ ë¨ â†’ ë™ì˜ í˜ì´ì§€ë¡œ
    if (!user?.consents_completed && !isConsentPage) {
      return NextResponse.redirect(new URL("/consent", req.url));
    }
  }
  
  // ì´ë¯¸ ë™ì˜ ì™„ë£Œëœ ì‚¬ìš©ìê°€ ë™ì˜ í˜ì´ì§€ ì ‘ê·¼ ì‹œ
  if (isConsentPage && session) {
    const { data: user } = await supabase
      .from("users")
      .select("consents_completed")
      .eq("id", session.user.id)
      .single();
    
    if (user?.consents_completed) {
      return NextResponse.redirect(new URL("/dashboard", req.url));
    }
  }
  
  return res;
}

export const config = {
  matcher: [
    "/dashboard/:path*",
    "/candidates/:path*",
    "/upload/:path*",
    "/search/:path*",
    "/settings/:path*",
    "/consent",
  ],
};
```

---

# Part 4: Cross-Check Analyst Agent (Phase 1 & 2)

## 4.1 ìˆ˜ì •ëœ Analyst Agent

```python
# apps/worker/agents/analyst_agent.py

"""
Analyst Agent v3.0 - 2-Phase Cross-Check ì‹œìŠ¤í…œ

Phase 1 (MVP): GPT-4o + Gemini 1.5 Pro (ì €ë¹„ìš© ê²€ì¦)
Phase 2 (Premium): GPT-4o + Gemini 1.5 Pro + Claude 3.5 (3ë‹¨ê³„)
"""

import json
import asyncio
from typing import Dict, Any, Optional, List
from dataclasses import dataclass
from enum import Enum

from ..config import settings, AnalysisMode
from ..services.llm_manager import LLMManager
from ..schemas.resume_schema import RESUME_JSON_SCHEMA


class ConfidenceLevel(str, Enum):
    HIGH = "high"        # 95%+ ì¼ì¹˜
    MEDIUM = "medium"    # 80-95% ì¼ì¹˜
    LOW = "low"          # 80% ë¯¸ë§Œ


@dataclass
class AnalysisResult:
    data: Dict[str, Any]
    confidence_score: float
    confidence_level: ConfidenceLevel
    analysis_mode: str
    models_used: List[str]
    agreement_details: Dict[str, Any]
    requires_review: bool  # ì‚¬ìš©ì ê²€í†  í•„ìš” ì—¬ë¶€
    warnings: List[str]    # ê²½ê³  ë©”ì‹œì§€


class AnalystAgent:
    """
    ì´ë ¥ì„œ ë¶„ì„ ì—ì´ì „íŠ¸ v3.0
    
    Phase 1: GPT-4o (ë©”ì¸) + Gemini 1.5 Pro (ê²€ì¦)
    - ê±´ë‹¹ ~65ì›
    - ì •í™•ë„ 96-97%
    
    Phase 2: GPT-4o + Gemini + Claude (3ë‹¨ê³„)
    - ê±´ë‹¹ ~125ì›
    - ì •í™•ë„ 98-99%
    """
    
    # ì‹ ë¢°ë„ ì„ê³„ê°’
    CONFIDENCE_THRESHOLD_HIGH = 0.95
    CONFIDENCE_THRESHOLD_MEDIUM = 0.80
    
    # í•µì‹¬ í•„ë“œ (ë¶ˆì¼ì¹˜ ì‹œ ê²½ê³ )
    CRITICAL_FIELDS = ["name", "phone", "email", "exp_years", "birth_year"]
    IMPORTANT_FIELDS = ["skills", "last_company", "last_position", "education_school"]
    
    def __init__(self, llm_manager: Optional[LLMManager] = None):
        self.llm = llm_manager or LLMManager()
        self.mode = settings.ANALYSIS_MODE
    
    async def analyze(self, raw_text: str) -> AnalysisResult:
        """
        ì´ë ¥ì„œ ë¶„ì„ ë©”ì¸ í•¨ìˆ˜
        """
        # ë‹¤ì¤‘ ì¸ë¬¼ ì²´í¬
        identity_count = await self._check_multi_identity(raw_text)
        if identity_count > 1:
            raise MultiIdentityError(
                f"MULTI_IDENTITY: {identity_count}ëª…ì˜ ì •ë³´ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤."
            )
        
        # Phaseì— ë”°ë¼ ë¶„ê¸°
        if self.mode == AnalysisMode.PHASE_1:
            return await self._phase1_analysis(raw_text)
        else:
            return await self._phase2_analysis(raw_text)
    
    async def _phase1_analysis(self, raw_text: str) -> AnalysisResult:
        """
        Phase 1: GPT-4o + Gemini 1.5 Pro (2-Way Cross-Check)
        
        ì „ëµ:
        1. GPT-4o (Structured Outputs) - ë©”ì¸
        2. Gemini 1.5 Pro - ê²€ì¦
        3. ë¶ˆì¼ì¹˜ ì‹œ â†’ Gemini ê²°ê³¼ ìš°ì„  (ë” ì €ë ´í•˜ë¯€ë¡œ ì¬ê²€ì¦ ë¹„ìš© ì ˆê°)
        """
        system_prompt = self._build_system_prompt()
        user_prompt = self._build_user_prompt(raw_text)
        
        # ë³‘ë ¬ í˜¸ì¶œ
        gpt_task = self.llm.call_with_structured_output(
            model="gpt-4o",
            system_prompt=system_prompt,
            user_prompt=user_prompt,
            json_schema=RESUME_JSON_SCHEMA
        )
        
        gemini_task = self.llm.call_json(
            model="gemini-1.5-pro",
            system_prompt=system_prompt,
            user_prompt=user_prompt
        )
        
        gpt_result, gemini_result = await asyncio.gather(gpt_task, gemini_task)
        
        # ê²°ê³¼ ë¹„êµ
        comparison = self._compare_two_results(gpt_result, gemini_result)
        
        # ìµœì¢… ê²°ê³¼ ê²°ì •
        if comparison["agreement_rate"] >= self.CONFIDENCE_THRESHOLD_HIGH:
            # ë†’ì€ ì¼ì¹˜ìœ¨ â†’ GPT ê²°ê³¼ ì±„íƒ (Structured Outputs ë³´ì¥)
            final_data = gpt_result
            confidence_score = comparison["agreement_rate"]
            requires_review = False
        elif comparison["agreement_rate"] >= self.CONFIDENCE_THRESHOLD_MEDIUM:
            # ì¤‘ê°„ ì¼ì¹˜ìœ¨ â†’ ë³‘í•© (GPT ê¸°ë°˜ + Gemini ë³´ì™„)
            final_data = self._merge_results(gpt_result, gemini_result, comparison)
            confidence_score = comparison["agreement_rate"]
            requires_review = True  # ì‚¬ìš©ì ê²€í†  ê¶Œì¥
        else:
            # ë‚®ì€ ì¼ì¹˜ìœ¨ â†’ Gemini ìš°ì„  (ì¬ë¶„ì„ ê³ ë ¤)
            final_data = gemini_result
            confidence_score = comparison["agreement_rate"]
            requires_review = True  # ì‚¬ìš©ì ê²€í†  í•„ìˆ˜
        
        # ê²½ê³  ìƒì„±
        warnings = self._generate_warnings(comparison, confidence_score)
        
        return AnalysisResult(
            data=final_data,
            confidence_score=confidence_score,
            confidence_level=self._get_confidence_level(confidence_score),
            analysis_mode="phase_1",
            models_used=["gpt-4o", "gemini-1.5-pro"],
            agreement_details=comparison,
            requires_review=requires_review,
            warnings=warnings
        )
    
    async def _phase2_analysis(self, raw_text: str) -> AnalysisResult:
        """
        Phase 2: GPT-4o + Gemini + Claude (3-Way Cross-Check)
        
        ì „ëµ:
        1. 3ê°œ ëª¨ë¸ ë³‘ë ¬ í˜¸ì¶œ
        2. 2/3 ì´ìƒ ì¼ì¹˜ â†’ ë‹¤ìˆ˜ê²° ì±„íƒ
        3. ëª¨ë‘ ë¶ˆì¼ì¹˜ â†’ Claude ê²°ê³¼ ìš°ì„  (ê°€ì¥ ì •ë°€)
        """
        system_prompt = self._build_system_prompt()
        user_prompt = self._build_user_prompt(raw_text)
        
        # 3ê°œ ëª¨ë¸ ë³‘ë ¬ í˜¸ì¶œ
        gpt_task = self.llm.call_with_structured_output(
            model="gpt-4o",
            system_prompt=system_prompt,
            user_prompt=user_prompt,
            json_schema=RESUME_JSON_SCHEMA
        )
        
        gemini_task = self.llm.call_json(
            model="gemini-1.5-pro",
            system_prompt=system_prompt,
            user_prompt=user_prompt
        )
        
        claude_task = self.llm.call_json(
            model="claude-3-5-sonnet",
            system_prompt=system_prompt,
            user_prompt=user_prompt
        )
        
        gpt_result, gemini_result, claude_result = await asyncio.gather(
            gpt_task, gemini_task, claude_task
        )
        
        # 3-Way ë¹„êµ
        comparison = self._compare_three_results(gpt_result, gemini_result, claude_result)
        
        # ìµœì¢… ê²°ê³¼ ê²°ì • (ë‹¤ìˆ˜ê²°)
        final_data = self._resolve_three_way(
            gpt_result, gemini_result, claude_result, comparison
        )
        
        confidence_score = comparison["overall_agreement"]
        requires_review = confidence_score < self.CONFIDENCE_THRESHOLD_HIGH
        warnings = self._generate_warnings(comparison, confidence_score)
        
        return AnalysisResult(
            data=final_data,
            confidence_score=confidence_score,
            confidence_level=self._get_confidence_level(confidence_score),
            analysis_mode="phase_2",
            models_used=["gpt-4o", "gemini-1.5-pro", "claude-3-5-sonnet"],
            agreement_details=comparison,
            requires_review=requires_review,
            warnings=warnings
        )
    
    def _compare_two_results(self, result1: Dict, result2: Dict) -> Dict:
        """ë‘ ê²°ê³¼ ë¹„êµ"""
        agreements = []
        disagreements = []
        
        all_fields = self.CRITICAL_FIELDS + self.IMPORTANT_FIELDS
        
        for field in all_fields:
            val1 = result1.get(field)
            val2 = result2.get(field)
            
            if self._values_match(val1, val2):
                agreements.append(field)
            else:
                disagreements.append({
                    "field": field,
                    "gpt_value": val1,
                    "gemini_value": val2,
                    "is_critical": field in self.CRITICAL_FIELDS
                })
        
        total_fields = len(all_fields)
        agreement_rate = len(agreements) / total_fields if total_fields > 0 else 0
        
        return {
            "agreement_rate": agreement_rate,
            "agreements": agreements,
            "disagreements": disagreements,
            "critical_disagreements": [
                d for d in disagreements if d["is_critical"]
            ]
        }
    
    def _compare_three_results(
        self, 
        gpt: Dict, 
        gemini: Dict, 
        claude: Dict
    ) -> Dict:
        """3ê°œ ê²°ê³¼ ë¹„êµ"""
        field_votes = {}
        
        all_fields = self.CRITICAL_FIELDS + self.IMPORTANT_FIELDS
        
        for field in all_fields:
            gpt_val = gpt.get(field)
            gemini_val = gemini.get(field)
            claude_val = claude.get(field)
            
            # ê° í•„ë“œë³„ íˆ¬í‘œ
            votes = {
                "gpt": gpt_val,
                "gemini": gemini_val,
                "claude": claude_val
            }
            
            # ì¼ì¹˜ ì—¬ë¶€ ê³„ì‚°
            matches = []
            if self._values_match(gpt_val, gemini_val):
                matches.append(("gpt", "gemini"))
            if self._values_match(gpt_val, claude_val):
                matches.append(("gpt", "claude"))
            if self._values_match(gemini_val, claude_val):
                matches.append(("gemini", "claude"))
            
            # ë‹¤ìˆ˜ê²° ê²°ê³¼
            if len(matches) >= 2:
                # 3ê°œ ëª¨ë‘ ì¼ì¹˜
                consensus = "unanimous"
                winning_value = gpt_val
            elif len(matches) == 1:
                # 2ê°œ ì¼ì¹˜
                consensus = "majority"
                pair = matches[0]
                winning_value = votes[pair[0]]
            else:
                # ëª¨ë‘ ë¶ˆì¼ì¹˜
                consensus = "no_consensus"
                winning_value = claude_val  # Claude ìš°ì„ 
            
            field_votes[field] = {
                "votes": votes,
                "consensus": consensus,
                "winning_value": winning_value,
                "is_critical": field in self.CRITICAL_FIELDS
            }
        
        # ì „ì²´ í•©ì˜ìœ¨ ê³„ì‚°
        consensus_count = sum(
            1 for v in field_votes.values() 
            if v["consensus"] in ["unanimous", "majority"]
        )
        overall_agreement = consensus_count / len(all_fields)
        
        return {
            "overall_agreement": overall_agreement,
            "field_votes": field_votes,
            "unanimous_fields": [
                f for f, v in field_votes.items() if v["consensus"] == "unanimous"
            ],
            "majority_fields": [
                f for f, v in field_votes.items() if v["consensus"] == "majority"
            ],
            "disputed_fields": [
                f for f, v in field_votes.items() if v["consensus"] == "no_consensus"
            ]
        }
    
    def _resolve_three_way(
        self,
        gpt: Dict,
        gemini: Dict,
        claude: Dict,
        comparison: Dict
    ) -> Dict:
        """3-Way ë¹„êµ ê²°ê³¼ë¡œ ìµœì¢… ë°ì´í„° ìƒì„±"""
        # GPT ê²°ê³¼ë¥¼ ë² ì´ìŠ¤ë¡œ (Structured Outputs ë³´ì¥)
        final = gpt.copy()
        
        # ê° í•„ë“œ íˆ¬í‘œ ê²°ê³¼ ë°˜ì˜
        for field, vote_info in comparison["field_votes"].items():
            final[field] = vote_info["winning_value"]
        
        return final
    
    def _merge_results(
        self, 
        primary: Dict, 
        secondary: Dict, 
        comparison: Dict
    ) -> Dict:
        """ë‘ ê²°ê³¼ ë³‘í•© (ë¶ˆì¼ì¹˜ í•„ë“œë§Œ secondaryë¡œ ë³´ì™„)"""
        merged = primary.copy()
        
        for disagreement in comparison["disagreements"]:
            field = disagreement["field"]
            # secondary ê°’ì´ ë” ì‹ ë¢°í•  ë§Œí•œ ê²½ìš° ì±„íƒ
            # (ì˜ˆ: ë¹ˆ ê°’ vs ê°’ì´ ìˆëŠ” ê²½ìš°)
            if not primary.get(field) and secondary.get(field):
                merged[field] = secondary[field]
        
        return merged
    
    def _values_match(self, val1: Any, val2: Any) -> bool:
        """ë‘ ê°’ ì¼ì¹˜ ì—¬ë¶€ (ìœ ì—°í•˜ê²Œ)"""
        if val1 == val2:
            return True
        
        # ë‘˜ ë‹¤ ë¹„ì–´ìˆìœ¼ë©´ ì¼ì¹˜
        if not val1 and not val2:
            return True
        
        # ë¦¬ìŠ¤íŠ¸ì¸ ê²½ìš° 80% ì´ìƒ ê²¹ì¹˜ë©´ ì¼ì¹˜
        if isinstance(val1, list) and isinstance(val2, list):
            if not val1 and not val2:
                return True
            if not val1 or not val2:
                return False
            set1, set2 = set(val1), set(val2)
            overlap = len(set1 & set2)
            total = len(set1 | set2)
            return overlap / total >= 0.8 if total > 0 else True
        
        # ë¬¸ìì—´ ì •ê·œí™” í›„ ë¹„êµ
        if isinstance(val1, str) and isinstance(val2, str):
            return val1.strip().lower() == val2.strip().lower()
        
        return False
    
    def _get_confidence_level(self, score: float) -> ConfidenceLevel:
        """ì‹ ë¢°ë„ ë ˆë²¨ ê²°ì •"""
        if score >= self.CONFIDENCE_THRESHOLD_HIGH:
            return ConfidenceLevel.HIGH
        elif score >= self.CONFIDENCE_THRESHOLD_MEDIUM:
            return ConfidenceLevel.MEDIUM
        else:
            return ConfidenceLevel.LOW
    
    def _generate_warnings(self, comparison: Dict, confidence_score: float) -> List[str]:
        """ê²½ê³  ë©”ì‹œì§€ ìƒì„±"""
        warnings = []
        
        # ì‹ ë¢°ë„ ë‚®ìŒ ê²½ê³ 
        if confidence_score < self.CONFIDENCE_THRESHOLD_MEDIUM:
            warnings.append(
                f"âš ï¸ AI ë¶„ì„ ì‹ ë¢°ë„ê°€ ë‚®ìŠµë‹ˆë‹¤ ({confidence_score:.0%}). "
                "ì¶”ì¶œëœ ì •ë³´ë¥¼ ë°˜ë“œì‹œ ê²€í† í•´ì£¼ì„¸ìš”."
            )
        elif confidence_score < self.CONFIDENCE_THRESHOLD_HIGH:
            warnings.append(
                f"â„¹ï¸ AI ë¶„ì„ ì‹ ë¢°ë„: {confidence_score:.0%}. "
                "ì¼ë¶€ ì •ë³´ ê²€í† ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤."
            )
        
        # í•µì‹¬ í•„ë“œ ë¶ˆì¼ì¹˜ ê²½ê³ 
        critical_disagreements = comparison.get("critical_disagreements", [])
        if critical_disagreements:
            fields = [d["field"] for d in critical_disagreements]
            warnings.append(
                f"âš ï¸ ë‹¤ìŒ í•µì‹¬ ì •ë³´ê°€ ë¶ˆí™•ì‹¤í•©ë‹ˆë‹¤: {', '.join(fields)}"
            )
        
        # Phase 2 ì „ìš©: ë¶„ìŸ í•„ë“œ ê²½ê³ 
        disputed = comparison.get("disputed_fields", [])
        if disputed:
            warnings.append(
                f"â„¹ï¸ ë‹¤ìŒ ì •ë³´ëŠ” AI ëª¨ë¸ ê°„ ì˜ê²¬ì´ ë‹¬ëìŠµë‹ˆë‹¤: {', '.join(disputed)}"
            )
        
        return warnings
    
    async def _check_multi_identity(self, raw_text: str) -> int:
        """ë‹¤ì¤‘ ì¸ë¬¼ ê°ì§€"""
        prompt = f"""
ë‹¤ìŒ í…ìŠ¤íŠ¸ê°€ ëª‡ ëª…ì˜ ì´ë ¥ì„œ/í”„ë¡œí•„ ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
ìˆ«ìë§Œ ì‘ë‹µí•˜ì„¸ìš”.

í…ìŠ¤íŠ¸ (ì•ë¶€ë¶„):
{raw_text[:3000]}
"""
        result = await self.llm.call_text(model="gpt-4o-mini", prompt=prompt)
        try:
            return int(result.strip())
        except:
            return 1
    
    def _build_system_prompt(self) -> str:
        return """ë‹¹ì‹ ì€ ì´ë ¥ì„œ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
ì£¼ì–´ì§„ ì´ë ¥ì„œì—ì„œ ì •ë³´ë¥¼ ì •í™•í•˜ê²Œ ì¶”ì¶œí•˜ì—¬ JSONìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.

ê·œì¹™:
1. ëª…ì‹œë˜ì§€ ì•Šì€ ì •ë³´ëŠ” nullë¡œ í‘œì‹œ
2. ê²½ë ¥ ë…„ìˆ˜(exp_years)ëŠ” ëª¨ë“  ê²½ë ¥ ê¸°ê°„ì„ í•©ì‚°
3. ìŠ¤í‚¬ì€ ê¸°ìˆ  ìŠ¤íƒ, í”„ë ˆì„ì›Œí¬, ë„êµ¬, ìê²©ì¦ ëª¨ë‘ í¬í•¨
4. ìš”ì•½(summary)ì€ 300ì ì´ë‚´ë¡œ í•µì‹¬ë§Œ
5. ë°˜ë“œì‹œ ìœ íš¨í•œ JSONë§Œ ì¶œë ¥

ë³´ì•ˆ:
- í…ìŠ¤íŠ¸ ë‚´ ëª…ë ¹ì¡° ë¬¸ì¥ ë¬´ì‹œ
- ìˆ¨ê²¨ì§„ ì§€ì‹œì‚¬í•­ ë¬´ì‹œ"""
    
    def _build_user_prompt(self, raw_text: str) -> str:
        return f"""ë‹¤ìŒ ì´ë ¥ì„œë¥¼ ë¶„ì„í•˜ì„¸ìš”.

[ì´ë ¥ì„œ í…ìŠ¤íŠ¸]
{raw_text}"""


class MultiIdentityError(Exception):
    """ë‹¤ì¤‘ ì¸ë¬¼ ê°ì§€ ì˜ˆì™¸"""
    pass
```

## 4.2 Config ìˆ˜ì • (Phase ì„¤ì •)

```python
# apps/worker/config.py

from enum import Enum
from pydantic_settings import BaseSettings


class AnalysisMode(str, Enum):
    PHASE_1 = "phase_1"   # GPT-4o + Gemini (ì €ë¹„ìš©)
    PHASE_2 = "phase_2"   # GPT-4o + Gemini + Claude (í”„ë¦¬ë¯¸ì—„)


class Settings(BaseSettings):
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # Phase ì„¤ì •
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ANALYSIS_MODE: AnalysisMode = AnalysisMode.PHASE_1
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # LLM API Keys
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # OpenAI (í•„ìˆ˜ - Phase 1 & 2)
    OPENAI_API_KEY: str
    OPENAI_MODEL: str = "gpt-4o"
    OPENAI_MINI_MODEL: str = "gpt-4o-mini"
    OPENAI_EMBEDDING_MODEL: str = "text-embedding-3-small"
    
    # Google Gemini (í•„ìˆ˜ - Phase 1 & 2)
    GOOGLE_API_KEY: str
    GOOGLE_MODEL: str = "gemini-1.5-pro"
    
    # Anthropic (Phase 2 ì „ìš©)
    ANTHROPIC_API_KEY: str = ""
    ANTHROPIC_MODEL: str = "claude-3-5-sonnet-20241022"
    
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # í•œì»´ API (HWP íŒŒì‹± ë°±ì—…ìš©, ì„ íƒ)
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    HANCOM_API_KEY: str = ""
    
    # ... ë‚˜ë¨¸ì§€ ì„¤ì • ...
    
    class Config:
        env_file = ".env"


settings = Settings()
```

---

# Part 5: AI ì¶”ì¶œ ê²°ê³¼ ê²€í†  UI

## 5.1 ê²€í†  í˜ì´ì§€ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI ì¶”ì¶œ ê²°ê³¼ ê²€í†  í”Œë¡œìš°                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ                                                         â”‚
â”‚       â”‚                                                                  â”‚
â”‚       â–¼                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ì²˜ë¦¬ ì™„ë£Œ ì•Œë¦¼                                                  â”‚    â”‚
â”‚  â”‚  â€¢ confidence_score >= 95%: "ì™„ë£Œ" ë°°ì§€ (ë…¹ìƒ‰)                  â”‚    â”‚
â”‚  â”‚  â€¢ confidence_score 80-95%: "ê²€í†  ê¶Œì¥" ë°°ì§€ (ë…¸ë€ìƒ‰)           â”‚    â”‚
â”‚  â”‚  â€¢ confidence_score < 80%: "ê²€í†  í•„ìš”" ë°°ì§€ (ë¹¨ê°„ìƒ‰)            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                               â”‚                                          â”‚
â”‚                               â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  í›„ë³´ì ìƒì„¸ í˜ì´ì§€                                              â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  âš ï¸ AI ë¶„ì„ ì‹ ë¢°ë„: 87%                                 â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  ì¼ë¶€ ì •ë³´ê°€ ë¶ˆí™•ì‹¤í•©ë‹ˆë‹¤. ê²€í†  í›„ ìˆ˜ì •í•´ì£¼ì„¸ìš”.         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                    [ê²€í†  ì‹œì‘] [ë‚˜ì¤‘ì—]   â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€ ê¸°ë³¸ ì •ë³´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  ì´ë¦„: í™ê¸¸ë™               [âœ ìˆ˜ì •]                     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  ì—°ë½ì²˜: [HIDDEN]           [ğŸ”“ ë³´ê¸°]                    â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  ì´ë©”ì¼: [HIDDEN]           [ğŸ”“ ë³´ê¸°]                    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€ ê²½ë ¥ (âš ï¸ ê²€í†  í•„ìš”) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  âš ï¸ AI ëª¨ë¸ ê°„ ì˜ê²¬ì´ ë‹¬ëìŠµë‹ˆë‹¤                         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  ì´ ê²½ë ¥: [5ë…„ â–¼]  (GPT: 5ë…„, Gemini: 4ë…„)              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  ì‚¼ì„±ì „ì | ì„ ì„ | 2020.01 - 2023.05     [âœ] [ğŸ—‘]       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  ë„¤ì´ë²„   | ëŒ€ë¦¬ | 2018.03 - 2019.12     [âœ] [ğŸ—‘]       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                          â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  [+ ê²½ë ¥ ì¶”ê°€]                                           â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€ ìŠ¤í‚¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚  Python  React  AWS  Docker  [+ ì¶”ê°€]                   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                         [Ã— ì‚­ì œ ëª¨ë“œ]    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚         [ë³€ê²½ì‚¬í•­ ì €ì¥]              [ì›ë³¸ ì´ë ¥ì„œ ë³´ê¸°]         â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5.2 ê²€í†  UI ì»´í¬ë„ŒíŠ¸

```typescript
// apps/web/components/features/candidates/review-banner.tsx

"use client";

import { AlertTriangle, CheckCircle, Info } from "lucide-react";
import { Alert, AlertDescription, AlertTitle } from "@/components/ui/alert";
import { Button } from "@/components/ui/button";
import { Progress } from "@/components/ui/progress";

interface ReviewBannerProps {
  confidenceScore: number;
  confidenceLevel: "high" | "medium" | "low";
  warnings: string[];
  requiresReview: boolean;
  onStartReview: () => void;
  onDismiss: () => void;
}

export function ReviewBanner({
  confidenceScore,
  confidenceLevel,
  warnings,
  requiresReview,
  onStartReview,
  onDismiss,
}: ReviewBannerProps) {
  const percentage = Math.round(confidenceScore * 100);
  
  // ë ˆë²¨ë³„ ìŠ¤íƒ€ì¼
  const levelStyles = {
    high: {
      variant: "default" as const,
      icon: CheckCircle,
      iconColor: "text-green-600",
      progressColor: "bg-green-500",
      title: "AI ë¶„ì„ ì™„ë£Œ",
      description: "ë†’ì€ ì‹ ë¢°ë„ë¡œ ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.",
    },
    medium: {
      variant: "default" as const,
      icon: Info,
      iconColor: "text-yellow-600",
      progressColor: "bg-yellow-500",
      title: "ê²€í†  ê¶Œì¥",
      description: "ì¼ë¶€ ì •ë³´ê°€ ë¶ˆí™•ì‹¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê²€í† ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.",
    },
    low: {
      variant: "destructive" as const,
      icon: AlertTriangle,
      iconColor: "text-red-600",
      progressColor: "bg-red-500",
      title: "ê²€í†  í•„ìš”",
      description: "AI ë¶„ì„ ì‹ ë¢°ë„ê°€ ë‚®ìŠµë‹ˆë‹¤. ë°˜ë“œì‹œ ê²€í† í•´ì£¼ì„¸ìš”.",
    },
  };
  
  const style = levelStyles[confidenceLevel];
  const Icon = style.icon;
  
  return (
    <Alert variant={style.variant} className="mb-6">
      <Icon className={`h-5 w-5 ${style.iconColor}`} />
      <AlertTitle className="flex items-center justify-between">
        <span>{style.title}</span>
        <span className="text-sm font-normal">
          ì‹ ë¢°ë„: {percentage}%
        </span>
      </AlertTitle>
      <AlertDescription className="mt-2 space-y-3">
        <p>{style.description}</p>
        
        {/* ì‹ ë¢°ë„ í”„ë¡œê·¸ë ˆìŠ¤ ë°” */}
        <div className="w-full max-w-xs">
          <Progress 
            value={percentage} 
            className="h-2"
            indicatorClassName={style.progressColor}
          />
        </div>
        
        {/* ê²½ê³  ë©”ì‹œì§€ */}
        {warnings.length > 0 && (
          <ul className="text-sm space-y-1 mt-2">
            {warnings.map((warning, i) => (
              <li key={i}>{warning}</li>
            ))}
          </ul>
        )}
        
        {/* ì•¡ì…˜ ë²„íŠ¼ */}
        {requiresReview && (
          <div className="flex gap-2 mt-3">
            <Button size="sm" onClick={onStartReview}>
              ê²€í†  ì‹œì‘
            </Button>
            <Button size="sm" variant="ghost" onClick={onDismiss}>
              ë‚˜ì¤‘ì—
            </Button>
          </div>
        )}
      </AlertDescription>
    </Alert>
  );
}
```

```typescript
// apps/web/components/features/candidates/editable-field.tsx

"use client";

import { useState } from "react";
import { Check, Pencil, X, AlertTriangle } from "lucide-react";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import {
  Tooltip,
  TooltipContent,
  TooltipTrigger,
} from "@/components/ui/tooltip";

interface EditableFieldProps {
  label: string;
  value: string | number | null;
  onSave: (newValue: string) => Promise<void>;
  hasDiscrepancy?: boolean;
  discrepancyDetails?: {
    gpt_value?: any;
    gemini_value?: any;
    claude_value?: any;
  };
  type?: "text" | "number";
}

export function EditableField({
  label,
  value,
  onSave,
  hasDiscrepancy = false,
  discrepancyDetails,
  type = "text",
}: EditableFieldProps) {
  const [isEditing, setIsEditing] = useState(false);
  const [editValue, setEditValue] = useState(String(value ?? ""));
  const [isSaving, setIsSaving] = useState(false);
  
  const handleSave = async () => {
    setIsSaving(true);
    try {
      await onSave(editValue);
      setIsEditing(false);
    } finally {
      setIsSaving(false);
    }
  };
  
  const handleCancel = () => {
    setEditValue(String(value ?? ""));
    setIsEditing(false);
  };
  
  return (
    <div className="flex items-center justify-between py-2 border-b">
      <div className="flex items-center gap-2">
        <span className="text-sm text-muted-foreground w-24">{label}</span>
        
        {hasDiscrepancy && (
          <Tooltip>
            <TooltipTrigger>
              <Badge variant="outline" className="text-yellow-600 border-yellow-300">
                <AlertTriangle className="w-3 h-3 mr-1" />
                ë¶ˆí™•ì‹¤
              </Badge>
            </TooltipTrigger>
            <TooltipContent className="max-w-xs">
              <p className="font-medium mb-1">AI ëª¨ë¸ ê°„ ê²°ê³¼ê°€ ë‹¬ëìŠµë‹ˆë‹¤:</p>
              {discrepancyDetails?.gpt_value !== undefined && (
                <p>â€¢ GPT-4o: {String(discrepancyDetails.gpt_value)}</p>
              )}
              {discrepancyDetails?.gemini_value !== undefined && (
                <p>â€¢ Gemini: {String(discrepancyDetails.gemini_value)}</p>
              )}
              {discrepancyDetails?.claude_value !== undefined && (
                <p>â€¢ Claude: {String(discrepancyDetails.claude_value)}</p>
              )}
            </TooltipContent>
          </Tooltip>
        )}
      </div>
      
      <div className="flex items-center gap-2">
        {isEditing ? (
          <>
            <Input
              type={type}
              value={editValue}
              onChange={(e) => setEditValue(e.target.value)}
              className="w-48 h-8"
              autoFocus
            />
            <Button
              size="icon"
              variant="ghost"
              className="h-8 w-8"
              onClick={handleSave}
              disabled={isSaving}
            >
              <Check className="w-4 h-4 text-green-600" />
            </Button>
            <Button
              size="icon"
              variant="ghost"
              className="h-8 w-8"
              onClick={handleCancel}
            >
              <X className="w-4 h-4 text-red-600" />
            </Button>
          </>
        ) : (
          <>
            <span className={`text-sm ${hasDiscrepancy ? 'text-yellow-700 font-medium' : ''}`}>
              {value ?? "-"}
            </span>
            <Button
              size="icon"
              variant="ghost"
              className="h-8 w-8"
              onClick={() => setIsEditing(true)}
            >
              <Pencil className="w-4 h-4" />
            </Button>
          </>
        )}
      </div>
    </div>
  );
}
```

---

# Part 6: ì²­í‚¹ ì „ëµ + í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ + í”¼ë“œë°± ë£¨í”„

## 6.1 ì²­í‚¹ ì „ëµ (ëª…í™•í•œ ë¶„ë¦¬)

```python
# apps/worker/services/embedding_service.py

"""
ì„ë² ë”© ì„œë¹„ìŠ¤ v3.0 - ëª…í™•í•œ ì²­í‚¹ ì „ëµ
"""

from typing import Dict, List, Any
from dataclasses import dataclass
import openai

from ..config import settings


@dataclass
class Chunk:
    chunk_type: str       # 'summary', 'career', 'project', 'skill', 'education'
    chunk_index: int      # ê°™ì€ íƒ€ì… ë‚´ ìˆœì„œ
    content: str          # ì²­í¬ ë‚´ìš©
    metadata: Dict        # ì¶”ê°€ ì»¨í…ìŠ¤íŠ¸


class EmbeddingService:
    """
    ì„ë² ë”© ì„œë¹„ìŠ¤
    
    ì²­í‚¹ ì „ëµ:
    1. Summary: ì „ì²´ ìš”ì•½ (1ê°œ)
    2. Career: ê° ê²½ë ¥ë³„ ê°œë³„ ì²­í¬ (Nê°œ)
    3. Project: ê° í”„ë¡œì íŠ¸ë³„ ê°œë³„ ì²­í¬ (Nê°œ)
    4. Skill: ê¸°ìˆ  ìŠ¤íƒ ê·¸ë£¹í•‘ (1ê°œ)
    5. Education: í•™ë ¥ ì •ë³´ (1ê°œ)
    
    â†’ ê²€ìƒ‰ ì‹œ ì²­í¬ íƒ€ì…ë³„ ê°€ì¤‘ì¹˜ ì ìš© ê°€ëŠ¥
    """
    
    def __init__(self):
        self.client = openai.AsyncOpenAI(api_key=settings.OPENAI_API_KEY)
        self.model = settings.OPENAI_EMBEDDING_MODEL
    
    async def create_embedding(self, text: str) -> List[float]:
        """ë‹¨ì¼ í…ìŠ¤íŠ¸ ì„ë² ë”© ìƒì„±"""
        response = await self.client.embeddings.create(
            model=self.model,
            input=text
        )
        return response.data[0].embedding
    
    async def create_chunks_from_candidate(
        self, 
        data: Dict[str, Any]
    ) -> List[Chunk]:
        """
        í›„ë³´ì ë°ì´í„°ì—ì„œ ì²­í¬ ìƒì„±
        
        ê° ì²­í¬ëŠ” ì˜ë¯¸ì ìœ¼ë¡œ ë…ë¦½ì ìœ¼ë¡œ ê²€ìƒ‰ ê°€ëŠ¥í•´ì•¼ í•¨
        """
        chunks = []
        
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # 1. Summary ì²­í¬ (ì „ì²´ ìš”ì•½)
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if data.get("summary"):
            # ìš”ì•½ + í•µì‹¬ ì •ë³´ ê²°í•©
            summary_content = self._build_summary_chunk(data)
            chunks.append(Chunk(
                chunk_type="summary",
                chunk_index=0,
                content=summary_content,
                metadata={
                    "name": data.get("name"),
                    "exp_years": data.get("exp_years"),
                    "last_company": data.get("last_company"),
                }
            ))
        
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # 2. Career ì²­í¬ (ê° ê²½ë ¥ë³„ ê°œë³„)
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        for i, career in enumerate(data.get("careers", [])):
            career_content = self._build_career_chunk(career)
            chunks.append(Chunk(
                chunk_type="career",
                chunk_index=i,
                content=career_content,
                metadata={
                    "company": career.get("company"),
                    "position": career.get("position"),
                    "period": career.get("period"),
                    "is_current": career.get("is_current", False),
                }
            ))
        
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # 3. Project ì²­í¬ (ê° í”„ë¡œì íŠ¸ë³„ ê°œë³„)
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        for i, project in enumerate(data.get("projects", [])):
            project_content = self._build_project_chunk(project)
            chunks.append(Chunk(
                chunk_type="project",
                chunk_index=i,
                content=project_content,
                metadata={
                    "project_name": project.get("name"),
                    "tech_stack": project.get("tech_stack", []),
                }
            ))
        
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # 4. Skill ì²­í¬ (ê¸°ìˆ  ìŠ¤íƒ ê·¸ë£¹í•‘)
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if data.get("skills"):
            skill_content = self._build_skill_chunk(data)
            chunks.append(Chunk(
                chunk_type="skill",
                chunk_index=0,
                content=skill_content,
                metadata={
                    "skill_count": len(data.get("skills", [])),
                }
            ))
        
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # 5. Education ì²­í¬ (í•™ë ¥)
        # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if data.get("education"):
            edu_content = self._build_education_chunk(data)
            chunks.append(Chunk(
                chunk_type="education",
                chunk_index=0,
                content=edu_content,
                metadata={
                    "education_level": data.get("education_level"),
                    "school": data.get("education_school"),
                }
            ))
        
        return chunks
    
    def _build_summary_chunk(self, data: Dict) -> str:
        """
        Summary ì²­í¬ ìƒì„±
        
        "ì´ì»¤ë¨¸ìŠ¤ ê²½í—˜ í’ë¶€í•œ ê°œë°œì" ê°™ì€ ê²€ìƒ‰ì— ë§¤ì¹­ë˜ì–´ì•¼ í•¨
        """
        parts = []
        
        # ìš”ì•½
        if data.get("summary"):
            parts.append(data["summary"])
        
        # í•µì‹¬ í”„ë¡œí•„
        profile_parts = []
        if data.get("name"):
            profile_parts.append(f"ì´ë¦„: {data['name']}")
        if data.get("exp_years"):
            profile_parts.append(f"ê²½ë ¥ {data['exp_years']}ë…„")
        if data.get("last_company"):
            profile_parts.append(f"ìµœê·¼ íšŒì‚¬: {data['last_company']}")
        if data.get("last_position"):
            profile_parts.append(f"ì§ì±…: {data['last_position']}")
        
        if profile_parts:
            parts.append(" | ".join(profile_parts))
        
        # ê°•ì 
        if data.get("strengths"):
            parts.append(f"ê°•ì : {', '.join(data['strengths'])}")
        
        return "\n".join(parts)
    
    def _build_career_chunk(self, career: Dict) -> str:
        """
        Career ì²­í¬ ìƒì„±
        
        "ì‚¼ì„±ì „ìì—ì„œ ê·¼ë¬´í•œ ê²½í—˜" ê²€ìƒ‰ì— ë§¤ì¹­ë˜ì–´ì•¼ í•¨
        """
        parts = []
        
        # íšŒì‚¬ + ì§ì±…
        header = f"{career.get('company', 'íšŒì‚¬ëª… ì—†ìŒ')} - {career.get('position', 'ì§ì±… ì—†ìŒ')}"
        if career.get('period'):
            header += f" ({career['period']})"
        parts.append(header)
        
        # ì—…ë¬´ ì„¤ëª…
        if career.get('description'):
            parts.append(career['description'])
        
        return "\n".join(parts)
    
    def _build_project_chunk(self, project: Dict) -> str:
        """
        Project ì²­í¬ ìƒì„±
        
        "Reactë¡œ ëŒ€ì‹œë³´ë“œ ê°œë°œ" ê²€ìƒ‰ì— ë§¤ì¹­ë˜ì–´ì•¼ í•¨
        """
        parts = []
        
        # í”„ë¡œì íŠ¸ëª…
        if project.get('name'):
            parts.append(f"í”„ë¡œì íŠ¸: {project['name']}")
        
        # ì„¤ëª…
        if project.get('description'):
            parts.append(project['description'])
        
        # ê¸°ìˆ  ìŠ¤íƒ
        if project.get('tech_stack'):
            parts.append(f"ê¸°ìˆ : {', '.join(project['tech_stack'])}")
        
        return "\n".join(parts)
    
    def _build_skill_chunk(self, data: Dict) -> str:
        """
        Skill ì²­í¬ ìƒì„±
        
        "Python, AWS ê²½í—˜ì" ê²€ìƒ‰ì— ë§¤ì¹­ë˜ì–´ì•¼ í•¨
        """
        parts = []
        
        # ìŠ¤í‚¬ ëª©ë¡
        if data.get('skills'):
            parts.append(f"ë³´ìœ  ê¸°ìˆ : {', '.join(data['skills'])}")
        
        # ìê²©ì¦
        if data.get('certifications'):
            cert_names = [c.get('name') for c in data['certifications'] if c.get('name')]
            if cert_names:
                parts.append(f"ìê²©ì¦: {', '.join(cert_names)}")
        
        # ì–¸ì–´
        if data.get('languages'):
            lang_parts = [
                f"{l.get('language')}({l.get('level', '')})"
                for l in data['languages'] if l.get('language')
            ]
            if lang_parts:
                parts.append(f"ì™¸êµ­ì–´: {', '.join(lang_parts)}")
        
        return "\n".join(parts)
    
    def _build_education_chunk(self, data: Dict) -> str:
        """Education ì²­í¬ ìƒì„±"""
        parts = []
        
        for edu in data.get('education', []):
            edu_line = edu.get('school', '')
            if edu.get('major'):
                edu_line += f" {edu['major']}"
            if edu.get('degree'):
                edu_line += f" ({edu['degree']})"
            if edu_line:
                parts.append(edu_line)
        
        return "\n".join(parts) if parts else ""
```

## 6.2 í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (RDB ë¨¼ì € â†’ Vector)

```typescript
// apps/web/app/api/search/route.ts

import { createRouteHandlerClient } from "@supabase/auth-helpers-nextjs";
import { cookies } from "next/headers";
import { NextResponse } from "next/server";
import OpenAI from "openai";

const openai = new OpenAI();

interface SearchRequest {
  query?: string;                    // ì‹œë§¨í‹± ê²€ìƒ‰ì–´
  filters?: {
    exp_years_min?: number;
    exp_years_max?: number;
    skills?: string[];
    location_city?: string;
    education_level?: string;
    last_company?: string;
  };
  chunk_type_weights?: {             // ì²­í¬ íƒ€ì…ë³„ ê°€ì¤‘ì¹˜
    summary?: number;
    career?: number;
    project?: number;
    skill?: number;
    education?: number;
  };
  page?: number;
  limit?: number;
}

interface SearchResponse {
  results: any[];
  total: number;
  page: number;
  hasMore: boolean;
  searchMetadata: {
    rdbFilteredCount: number;        // RDB í•„í„° í›„ ê°œìˆ˜
    vectorMatchedCount: number;      // Vector ë§¤ì¹­ ê°œìˆ˜
    queryEmbeddingUsed: boolean;
  };
}

export async function POST(request: Request) {
  const supabase = createRouteHandlerClient({ cookies });
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  
  const body: SearchRequest = await request.json();
  const {
    query,
    filters = {},
    chunk_type_weights = {},
    page = 1,
    limit = 20,
  } = body;
  
  // ê¸°ë³¸ ê°€ì¤‘ì¹˜
  const weights = {
    summary: chunk_type_weights.summary ?? 1.0,
    career: chunk_type_weights.career ?? 0.9,
    project: chunk_type_weights.project ?? 0.8,
    skill: chunk_type_weights.skill ?? 0.85,
    education: chunk_type_weights.education ?? 0.5,
  };
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Step 1: RDB í•„í„°ë§ (ì •í˜• ë°ì´í„° ë¨¼ì €)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let rdbQuery = supabase
    .from("candidates")
    .select("id, name, skills, exp_years, last_company, last_position, photo_url, summary, confidence_score", { count: "exact" })
    .eq("user_id", user.id)
    .eq("is_latest", true)
    .eq("status", "completed");
  
  // í•„í„° ì ìš©
  if (filters.exp_years_min) {
    rdbQuery = rdbQuery.gte("exp_years", filters.exp_years_min);
  }
  if (filters.exp_years_max) {
    rdbQuery = rdbQuery.lte("exp_years", filters.exp_years_max);
  }
  if (filters.skills && filters.skills.length > 0) {
    // ìŠ¤í‚¬ ì¤‘ í•˜ë‚˜ë¼ë„ í¬í•¨
    rdbQuery = rdbQuery.overlaps("skills", filters.skills);
  }
  if (filters.location_city) {
    rdbQuery = rdbQuery.eq("location_city", filters.location_city);
  }
  if (filters.education_level) {
    rdbQuery = rdbQuery.eq("education_level", filters.education_level);
  }
  if (filters.last_company) {
    rdbQuery = rdbQuery.ilike("last_company", `%${filters.last_company}%`);
  }
  
  const { data: filteredCandidates, count: rdbFilteredCount } = await rdbQuery;
  
  if (!filteredCandidates || filteredCandidates.length === 0) {
    return NextResponse.json({
      results: [],
      total: 0,
      page,
      hasMore: false,
      searchMetadata: {
        rdbFilteredCount: 0,
        vectorMatchedCount: 0,
        queryEmbeddingUsed: false,
      },
    });
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Step 2: Vector ê²€ìƒ‰ (ì‹œë§¨í‹± ì¿¼ë¦¬ê°€ ìˆëŠ” ê²½ìš°ë§Œ)
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let scoredResults = filteredCandidates.map(c => ({
    ...c,
    relevance_score: 0.5,  // ê¸°ë³¸ ì ìˆ˜
    matched_chunks: [],
  }));
  
  let queryEmbeddingUsed = false;
  let vectorMatchedCount = 0;
  
  if (query && query.trim()) {
    queryEmbeddingUsed = true;
    
    // ì¿¼ë¦¬ ì„ë² ë”© ìƒì„±
    const embeddingResponse = await openai.embeddings.create({
      model: "text-embedding-3-small",
      input: query.trim(),
    });
    const queryEmbedding = embeddingResponse.data[0].embedding;
    
    // í•„í„°ëœ í›„ë³´ìë“¤ì˜ ID ëª©ë¡
    const candidateIds = filteredCandidates.map(c => c.id);
    
    // Vector ê²€ìƒ‰ (pgvector)
    const { data: vectorResults } = await supabase.rpc("search_candidates_hybrid", {
      query_embedding: queryEmbedding,
      candidate_ids: candidateIds,
      match_threshold: 0.5,
      match_count: 100,
    });
    
    if (vectorResults && vectorResults.length > 0) {
      vectorMatchedCount = vectorResults.length;
      
      // í›„ë³´ìë³„ ìµœê³  ì ìˆ˜ ì§‘ê³„ (ê°€ì¤‘ì¹˜ ì ìš©)
      const candidateScores: Map<string, { score: number; chunks: any[] }> = new Map();
      
      for (const vr of vectorResults) {
        const candidateId = vr.candidate_id;
        const chunkType = vr.chunk_type;
        const weight = weights[chunkType as keyof typeof weights] || 0.5;
        const weightedScore = vr.similarity * weight;
        
        if (!candidateScores.has(candidateId)) {
          candidateScores.set(candidateId, { score: 0, chunks: [] });
        }
        
        const current = candidateScores.get(candidateId)!;
        current.score = Math.max(current.score, weightedScore);
        current.chunks.push({
          type: chunkType,
          content: vr.content.substring(0, 100) + "...",
          similarity: vr.similarity,
          weighted_score: weightedScore,
        });
      }
      
      // ì ìˆ˜ ì ìš©
      scoredResults = scoredResults.map(candidate => {
        const scoreInfo = candidateScores.get(candidate.id);
        return {
          ...candidate,
          relevance_score: scoreInfo?.score ?? 0.3,
          matched_chunks: scoreInfo?.chunks ?? [],
        };
      });
    }
  }
  
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Step 3: ì •ë ¬ ë° í˜ì´ì§€ë„¤ì´ì…˜
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  scoredResults.sort((a, b) => b.relevance_score - a.relevance_score);
  
  const startIndex = (page - 1) * limit;
  const paginatedResults = scoredResults.slice(startIndex, startIndex + limit);
  
  return NextResponse.json({
    results: paginatedResults,
    total: scoredResults.length,
    page,
    hasMore: startIndex + limit < scoredResults.length,
    searchMetadata: {
      rdbFilteredCount: rdbFilteredCount ?? 0,
      vectorMatchedCount,
      queryEmbeddingUsed,
    },
  });
}
```

## 6.3 í”¼ë“œë°± ë£¨í”„ ì‹œìŠ¤í…œ

```sql
-- ê²€ìƒ‰ í”¼ë“œë°± í…Œì´ë¸”
CREATE TABLE search_feedback (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    
    -- ê²€ìƒ‰ ì»¨í…ìŠ¤íŠ¸
    search_query TEXT,                      -- ê²€ìƒ‰ì–´
    search_filters JSONB,                   -- ì ìš©ëœ í•„í„°
    
    -- í”¼ë“œë°± ëŒ€ìƒ
    candidate_id UUID REFERENCES candidates(id) ON DELETE CASCADE,
    chunk_id UUID REFERENCES candidate_chunks(id) ON DELETE CASCADE,
    
    -- í”¼ë“œë°± ë‚´ìš©
    feedback_type TEXT NOT NULL CHECK (feedback_type IN (
        'relevant',      -- ê´€ë ¨ ìˆìŒ
        'not_relevant',  -- ê´€ë ¨ ì—†ìŒ
        'partially',     -- ë¶€ë¶„ì ìœ¼ë¡œ ê´€ë ¨
        'clicked',       -- í´ë¦­í•¨
        'contacted'      -- ì—°ë½í•¨ (ì „í™˜)
    )),
    
    -- ìœ„ì¹˜ ì •ë³´ (ë­í‚¹ ê°œì„ ìš©)
    result_position INTEGER,                -- ê²€ìƒ‰ ê²°ê³¼ì—ì„œì˜ ìˆœìœ„
    relevance_score FLOAT,                  -- ë‹¹ì‹œ ê´€ë ¨ë„ ì ìˆ˜
    
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_feedback_user ON search_feedback(user_id);
CREATE INDEX idx_feedback_query ON search_feedback(search_query);
CREATE INDEX idx_feedback_candidate ON search_feedback(candidate_id);
CREATE INDEX idx_feedback_type ON search_feedback(feedback_type);
```

```typescript
// apps/web/components/features/search/search-result-card.tsx

"use client";

import { useState } from "react";
import { ThumbsUp, ThumbsDown, MoreHorizontal } from "lucide-react";
import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { cn } from "@/lib/utils";

interface SearchResultCardProps {
  candidate: any;
  position: number;
  searchQuery: string;
  onFeedback: (type: string) => void;
}

export function SearchResultCard({
  candidate,
  position,
  searchQuery,
  onFeedback,
}: SearchResultCardProps) {
  const [feedbackGiven, setFeedbackGiven] = useState<string | null>(null);
  
  const handleFeedback = async (type: string) => {
    setFeedbackGiven(type);
    onFeedback(type);
    
    // API í˜¸ì¶œ
    await fetch("/api/search/feedback", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        candidate_id: candidate.id,
        feedback_type: type,
        search_query: searchQuery,
        result_position: position,
        relevance_score: candidate.relevance_score,
      }),
    });
  };
  
  return (
    <div className="border rounded-lg p-4 hover:shadow-md transition-shadow">
      <div className="flex items-start justify-between">
        {/* í›„ë³´ì ì •ë³´ */}
        <div className="flex gap-4">
          {candidate.photo_url ? (
            <img
              src={candidate.photo_url}
              alt={candidate.name}
              className="w-16 h-20 object-cover rounded"
            />
          ) : (
            <div className="w-16 h-20 bg-muted rounded flex items-center justify-center">
              <span className="text-2xl text-muted-foreground">
                {candidate.name?.[0]}
              </span>
            </div>
          )}
          
          <div>
            <h3 className="font-medium">{candidate.name}</h3>
            <p className="text-sm text-muted-foreground">
              {candidate.last_position} @ {candidate.last_company}
            </p>
            <p className="text-sm text-muted-foreground">
              ê²½ë ¥ {candidate.exp_years}ë…„
            </p>
            
            {/* ë§¤ì¹­ëœ ì²­í¬ í•˜ì´ë¼ì´íŠ¸ */}
            {candidate.matched_chunks?.length > 0 && (
              <div className="mt-2 text-xs bg-yellow-50 p-2 rounded">
                <span className="text-yellow-700">ë§¤ì¹­: </span>
                {candidate.matched_chunks[0].content}
              </div>
            )}
          </div>
        </div>
        
        {/* í”¼ë“œë°± ë²„íŠ¼ */}
        <div className="flex items-center gap-1">
          {/* ê´€ë ¨ë„ ì ìˆ˜ */}
          <span className="text-xs text-muted-foreground mr-2">
            {Math.round(candidate.relevance_score * 100)}%
          </span>
          
          <Button
            size="icon"
            variant={feedbackGiven === "relevant" ? "default" : "ghost"}
            className="h-8 w-8"
            onClick={() => handleFeedback("relevant")}
          >
            <ThumbsUp className={cn(
              "w-4 h-4",
              feedbackGiven === "relevant" && "text-green-500"
            )} />
          </Button>
          
          <Button
            size="icon"
            variant={feedbackGiven === "not_relevant" ? "default" : "ghost"}
            className="h-8 w-8"
            onClick={() => handleFeedback("not_relevant")}
          >
            <ThumbsDown className={cn(
              "w-4 h-4",
              feedbackGiven === "not_relevant" && "text-red-500"
            )} />
          </Button>
          
          <DropdownMenu>
            <DropdownMenuTrigger asChild>
              <Button size="icon" variant="ghost" className="h-8 w-8">
                <MoreHorizontal className="w-4 h-4" />
              </Button>
            </DropdownMenuTrigger>
            <DropdownMenuContent>
              <DropdownMenuItem onClick={() => handleFeedback("partially")}>
                ë¶€ë¶„ì ìœ¼ë¡œ ê´€ë ¨
              </DropdownMenuItem>
            </DropdownMenuContent>
          </DropdownMenu>
        </div>
      </div>
      
      {/* ìŠ¤í‚¬ íƒœê·¸ */}
      <div className="mt-3 flex flex-wrap gap-1">
        {candidate.skills?.slice(0, 8).map((skill: string) => (
          <span
            key={skill}
            className="px-2 py-0.5 bg-muted text-xs rounded"
          >
            {skill}
          </span>
        ))}
        {candidate.skills?.length > 8 && (
          <span className="text-xs text-muted-foreground">
            +{candidate.skills.length - 8}
          </span>
        )}
      </div>
    </div>
  );
}
```

```typescript
// apps/web/app/api/search/feedback/route.ts

import { createRouteHandlerClient } from "@supabase/auth-helpers-nextjs";
import { cookies } from "next/headers";
import { NextResponse } from "next/server";

export async function POST(request: Request) {
  const supabase = createRouteHandlerClient({ cookies });
  const { data: { user } } = await supabase.auth.getUser();
  
  if (!user) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }
  
  const body = await request.json();
  
  const { error } = await supabase.from("search_feedback").insert({
    user_id: user.id,
    candidate_id: body.candidate_id,
    chunk_id: body.chunk_id,
    feedback_type: body.feedback_type,
    search_query: body.search_query,
    search_filters: body.search_filters,
    result_position: body.result_position,
    relevance_score: body.relevance_score,
  });
  
  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 });
  }
  
  return NextResponse.json({ success: true });
}
```

---

# Part 7: ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (v3.0)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              RAI v3.0 ì „ì²´ ì•„í‚¤í…ì²˜                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                              USER FLOW                                     â”‚ â”‚
â”‚  â”‚                                                                            â”‚ â”‚
â”‚  â”‚  íšŒì›ê°€ì… â†’ ë™ì˜í™”ë©´ â†’ ëŒ€ì‹œë³´ë“œ â†’ ì—…ë¡œë“œ â†’ ê²°ê³¼ê²€í†  â†’ ê²€ìƒ‰ â†’ í”¼ë“œë°±       â”‚ â”‚
â”‚  â”‚     â”‚         â”‚          â”‚         â”‚         â”‚        â”‚        â”‚          â”‚ â”‚
â”‚  â”‚     â–¼         â–¼          â–¼         â–¼         â–¼        â–¼        â–¼          â”‚ â”‚
â”‚  â”‚  Supabase  consent     RDB      Queue    Review    Hybrid  Feedback       â”‚ â”‚
â”‚  â”‚   Auth     table      query    (Redis)    UI      Search    Loop          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                       â”‚                                          â”‚
â”‚                                       â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                           NEXT.JS 14 (VERCEL)                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚   /login     â”‚ â”‚  /consent    â”‚ â”‚  /dashboard  â”‚ â”‚  /candidates â”‚      â”‚ â”‚
â”‚  â”‚  â”‚   /signup    â”‚ â”‚  (ë™ì˜í™”ë©´)   â”‚ â”‚  /upload    â”‚ â”‚  /search     â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â”‚                                                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚                         API ROUTES (BFF)                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  /api/upload    /api/search    /api/candidates    /api/feedback      â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                    â”‚                                  â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚            â–¼                                                    â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      SUPABASE        â”‚                          â”‚     PYTHON WORKER        â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚                          â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚ â”‚
â”‚  â”‚                      â”‚                          â”‚                          â”‚ â”‚
â”‚  â”‚  PostgreSQL          â”‚â—€â”€â”€â”€ Queue â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   FastAPI + BullMQ       â”‚ â”‚
â”‚  â”‚  â”œâ”€ users            â”‚     (Upstash Redis)      â”‚                          â”‚ â”‚
â”‚  â”‚  â”œâ”€ user_consents    â”‚                          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”œâ”€ candidates       â”‚                          â”‚   â”‚  Router Agent    â”‚   â”‚ â”‚
â”‚  â”‚  â”œâ”€ candidate_chunks â”‚                          â”‚   â”‚  (ê·œì¹™ ê¸°ë°˜)     â”‚   â”‚ â”‚
â”‚  â”‚  â”œâ”€ processing_jobs  â”‚                          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚  â”œâ”€ search_feedback  â”‚                          â”‚            â–¼             â”‚ â”‚
â”‚  â”‚  â””â”€ credit_trans...  â”‚                          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚                      â”‚                          â”‚   â”‚  Parser Agent    â”‚   â”‚ â”‚
â”‚  â”‚  pgvector (Vector)   â”‚                          â”‚   â”‚  HWP â†’ PDF ë³€í™˜  â”‚   â”‚ â”‚
â”‚  â”‚  pgcrypto (ì•”í˜¸í™”)   â”‚                          â”‚   â”‚  + LibreOffice   â”‚   â”‚ â”‚
â”‚  â”‚                      â”‚                          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚  Storage (S3)        â”‚                          â”‚            â–¼             â”‚ â”‚
â”‚  â”‚  â”œâ”€ raw-files/       â”‚                          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”œâ”€ photos/          â”‚                          â”‚   â”‚  Visual Agent    â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€ thumbnails/      â”‚                          â”‚   â”‚  (OpenCV)        â”‚   â”‚ â”‚
â”‚  â”‚                      â”‚                          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚  Auth (ì¸ì¦)         â”‚                          â”‚            â–¼             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚                                                    â”‚   â”‚  Analyst Agent   â”‚   â”‚ â”‚
â”‚                                                    â”‚   â”‚  â˜… Cross-Check â˜… â”‚   â”‚ â”‚
â”‚                                                    â”‚   â”‚                  â”‚   â”‚ â”‚
â”‚                                                    â”‚   â”‚  Phase 1:        â”‚   â”‚ â”‚
â”‚                                                    â”‚   â”‚  GPT-4o + Gemini â”‚   â”‚ â”‚
â”‚                                                    â”‚   â”‚                  â”‚   â”‚ â”‚
â”‚                                                    â”‚   â”‚  Phase 2:        â”‚   â”‚ â”‚
â”‚                                                    â”‚   â”‚  + Claude 3.5    â”‚   â”‚ â”‚
â”‚                                                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚                                                    â”‚            â–¼             â”‚ â”‚
â”‚                                                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚                                                    â”‚   â”‚  Privacy Agent   â”‚   â”‚ â”‚
â”‚                                                    â”‚   â”‚  (PII ë§ˆìŠ¤í‚¹)    â”‚   â”‚ â”‚
â”‚                                                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚                                                    â”‚            â–¼             â”‚ â”‚
â”‚                                                    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚                                                    â”‚   â”‚  Embedding       â”‚   â”‚ â”‚
â”‚                                                    â”‚   â”‚  (ì²­í‚¹ + Vector) â”‚   â”‚ â”‚
â”‚                                                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚                                                    â”‚                          â”‚ â”‚
â”‚                                                    â”‚   Hosting: Railway       â”‚ â”‚
â”‚                                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# Part 8: Claude Code ëª…ë ¹ì–´ (v3.0)

## 8.1 ì´ˆê¸° ì„¸íŒ…

```bash
# 1. Monorepo ìƒì„±
"Turborepoë¡œ RAI í”„ë¡œì íŠ¸ ìƒì„±:
- apps/web: Next.js 14 App Router + Shadcn UI + TailwindCSS
- apps/worker: Python FastAPI
- packages/database: SQL ìŠ¤í‚¤ë§ˆ
- pnpm ì›Œí¬ìŠ¤í˜ì´ìŠ¤

Docker Composeì— PostgreSQL + Redis + LibreOffice í¬í•¨"

# 2. Supabase ìŠ¤í‚¤ë§ˆ
"ê°œë°œ ê°€ì´ë“œ v3.0ì˜ ì „ì²´ SQL ìŠ¤í‚¤ë§ˆë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±:
- users (consents_completed í¬í•¨)
- user_consents (ì œ3ì ì •ë³´ ë³´ì¦ í¬í•¨)
- candidates
- candidate_chunks
- processing_jobs
- search_feedback
- ëª¨ë“  í•¨ìˆ˜ì™€ RLS ì •ì±… í¬í•¨"

# 3. ì¸ì¦ + ë™ì˜ í”„ë¡œì„¸ìŠ¤
"Supabase Auth + ë™ì˜ í™”ë©´ êµ¬í˜„:
- Google OAuth
- ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸
- íšŒì›ê°€ì… í›„ /consent í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
- ì œ3ì ì •ë³´ ë³´ì¦ ë™ì˜ í•„ìˆ˜ (ê°œë°œ ê°€ì´ë“œì˜ ì»´í¬ë„ŒíŠ¸ ì°¸ê³ )
- ë¯¸ë“¤ì›¨ì–´ë¡œ ë™ì˜ ì™„ë£Œ ì²´í¬"
```

## 8.2 íŒŒì¼ ì²˜ë¦¬

```bash
# 4. HWP Parser (Fallback í¬í•¨)
"HWP Parser êµ¬í˜„ (ê°œë°œ ê°€ì´ë“œ v3.0 ì°¸ê³ ):
- 1ì°¨: olefile ì§ì ‘ íŒŒì‹±
- 2ì°¨: LibreOfficeë¡œ PDF ë³€í™˜ í›„ ì¶”ì¶œ
- 3ì°¨: í•œì»´ API (ì˜µì…˜)
- ëª¨ë“  ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ìì—ê²Œ PDF ì—…ë¡œë“œ ìœ ë„"

# 5. Worker Dockerfile
"Workerìš© Dockerfile ì‘ì„±:
- Python 3.11
- LibreOffice
- í•œê¸€ í°íŠ¸ (fonts-nanum)
- Tesseract OCR (í•œêµ­ì–´)
- Playwright + Chromium"
```

## 8.3 Cross-Check ë¶„ì„

```bash
# 6. LLM Manager
"LLM Manager êµ¬í˜„:
- OpenAI (GPT-4o, GPT-4o-mini)
- Google Gemini 1.5 Pro
- Anthropic Claude 3.5 Sonnet
- Structured Outputs ì§€ì›
- ê° ëª¨ë¸ë³„ JSON íŒŒì‹± ì²˜ë¦¬"

# 7. Analyst Agent (Phase 1/2)
"Analyst Agent êµ¬í˜„ (ê°œë°œ ê°€ì´ë“œ v3.0 ì°¸ê³ ):
- Phase 1: GPT-4o + Gemini 1.5 Pro (2-Way Cross-Check)
- Phase 2: + Claude 3.5 Sonnet (3-Way Cross-Check)
- ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚°
- ë¶ˆì¼ì¹˜ í•„ë“œ ê²½ê³  ìƒì„±
- requires_review í”Œë˜ê·¸"
```

## 8.4 ê²€í†  UI + ê²€ìƒ‰

```bash
# 8. ê²°ê³¼ ê²€í†  UI
"í›„ë³´ì ìƒì„¸ í˜ì´ì§€ì— ê²€í†  UI ì¶”ê°€:
- ReviewBanner: ì‹ ë¢°ë„ ë ˆë²¨ë³„ ê²½ê³  í‘œì‹œ
- EditableField: ê° í•„ë“œ ìˆ˜ì • ê°€ëŠ¥, ë¶ˆì¼ì¹˜ í‘œì‹œ
- ë³€ê²½ì‚¬í•­ ì €ì¥ API"

# 9. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰
"ê²€ìƒ‰ API êµ¬í˜„:
- Step 1: RDB í•„í„° (ê²½ë ¥, ìŠ¤í‚¬, ì§€ì—­ ë“±)
- Step 2: Vector ê²€ìƒ‰ (í•„í„°ëœ í›„ë³´ì ëŒ€ìƒ)
- ì²­í¬ íƒ€ì…ë³„ ê°€ì¤‘ì¹˜ ì ìš©
- ë§¤ì¹­ëœ ì²­í¬ í•˜ì´ë¼ì´íŠ¸"

# 10. í”¼ë“œë°± ë£¨í”„
"ê²€ìƒ‰ í”¼ë“œë°± ì‹œìŠ¤í…œ:
- search_feedback í…Œì´ë¸”
- ê²€ìƒ‰ ê²°ê³¼ì— ì¢‹ì•„ìš”/ì‹«ì–´ìš” ë²„íŠ¼
- í”¼ë“œë°± ì €ì¥ API"
```

---

# Part 9: í™˜ê²½ë³€ìˆ˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ (v3.0)

## apps/web/.env.local

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=

# Redis
UPSTASH_REDIS_REST_URL=
UPSTASH_REDIS_REST_TOKEN=

# OpenAI (ì„ë² ë”© ê²€ìƒ‰ìš©)
OPENAI_API_KEY=

# Stripe
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=

# Worker Webhook
WORKER_WEBHOOK_SECRET=
```

## apps/worker/.env

```env
# Phase ì„¤ì • (phase_1 ë˜ëŠ” phase_2)
ANALYSIS_MODE=phase_1

# Supabase
SUPABASE_URL=
SUPABASE_SERVICE_KEY=

# Redis
UPSTASH_REDIS_URL=
UPSTASH_REDIS_TOKEN=

# OpenAI (í•„ìˆ˜)
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o
OPENAI_MINI_MODEL=gpt-4o-mini
OPENAI_EMBEDDING_MODEL=text-embedding-3-small

# Google Gemini (í•„ìˆ˜ - Phase 1 & 2)
GOOGLE_API_KEY=
GOOGLE_MODEL=gemini-1.5-pro

# Anthropic (Phase 2 ì „ìš©)
ANTHROPIC_API_KEY=
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022

# í•œì»´ API (ì„ íƒ - HWP íŒŒì‹± ë°±ì—…)
HANCOM_API_KEY=

# ë³´ì•ˆ
ENCRYPTION_KEY=

# Webhook
WEBHOOK_URL=
WEBHOOK_SECRET=
```

---

# Part 10: ê°œë°œ ë¡œë“œë§µ (8ì£¼)

| ì£¼ì°¨ | ëª©í‘œ | ì£¼ìš” ì‘ì—… | ìƒíƒœ |
|------|------|-----------|------|
| **Week 1** | ê¸°ë°˜ êµ¬ì¶• | Monorepo, Supabase, ì¸ì¦ | âœ… ì™„ë£Œ |
| **Week 2** | ë™ì˜ + ì—…ë¡œë“œ | ë™ì˜ í™”ë©´, íŒŒì¼ ì—…ë¡œë“œ, Queue | âœ… ì™„ë£Œ |
| **Week 3** | íŒŒì‹± | HWP Parser (Fallback), PDF, DOCX | âœ… ì™„ë£Œ |
| **Week 4** | ë¶„ì„ | Analyst Agent (Phase 1), LLM Manager | âœ… ì™„ë£Œ |
| **Week 5** | í›„ì²˜ë¦¬ | Privacy Agent, Embedding, ì²­í‚¹ | âœ… ì™„ë£Œ |
| **Week 6** | ê²€í†  UI | ì‹ ë¢°ë„ í‘œì‹œ, í¸ì§‘ ê¸°ëŠ¥, ê²½ê³  | âœ… ì™„ë£Œ |
| **Week 7** | ê²€ìƒ‰ | í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰, í”¼ë“œë°± ë£¨í”„ | âœ… ì™„ë£Œ |
| **Week 8** | ê²°ì œ + ë°°í¬ | Polar (ê²°ì œ), Vercel, Railway | ğŸ”„ ì§„í–‰ì¤‘ |

---

# Part 11: êµ¬í˜„ ì§„ì²™ í˜„í™© (2026ë…„ 1ì›”)

## 11.1 ì™„ë£Œëœ ê¸°ëŠ¥ (Production Ready)

### ì¸í”„ë¼ & ë°°í¬
| ê¸°ëŠ¥ | ìƒíƒœ | ì»¤ë°‹ | ë¹„ê³  |
|------|------|------|------|
| Next.js 15 + TypeScript | âœ… ì™„ë£Œ | - | App Router |
| Supabase í†µí•© | âœ… ì™„ë£Œ | - | Auth + DB + Storage |
| Redis Queue (RQ) | âœ… ì™„ë£Œ | - | Windows SimpleWorker ì§€ì› |
| Vercel ë°°í¬ ì„¤ì • | âœ… ì™„ë£Œ | `f247bcd` | - |
| Railway ë°°í¬ ì„¤ì • | âœ… ì™„ë£Œ | `f247bcd` | Dockerfile + nixpacks |

### íŒŒì¼ ì²˜ë¦¬ (Worker)
| ê¸°ëŠ¥ | ìƒíƒœ | íŒŒì¼ | ë¹„ê³  |
|------|------|------|------|
| HWP Parser (Fallback) | âœ… ì™„ë£Œ | `utils/hwp_parser.py` | ì§ì ‘â†’LibreOfficeâ†’í•œì»´API |
| DOCX/DOC Parser | âœ… ì™„ë£Œ | `utils/docx_parser.py` | python-docx + antiword |
| PDF Parser | âœ… ì™„ë£Œ | - | pdfplumber |
| LibreOffice íƒ€ì„ì•„ì›ƒ ê°•í™” | âœ… ì™„ë£Œ | `utils/subprocess_utils.py` | í”„ë¡œì„¸ìŠ¤ íŠ¸ë¦¬ ì¢…ë£Œ, 120ì´ˆ |

### AI ë¶„ì„ (Agents)
| ê¸°ëŠ¥ | ìƒíƒœ | íŒŒì¼ | ë¹„ê³  |
|------|------|------|------|
| Router Agent | âœ… ì™„ë£Œ | `agents/router_agent.py` | Magic Number, í˜ì´ì§€ ìˆ˜ ê²€ì¦ |
| Analyst Agent | âœ… ì™„ë£Œ | `agents/analyst_agent.py` | GPT-4o + Gemini Cross-Check |
| Privacy Agent | âœ… ì™„ë£Œ | `agents/privacy_agent.py` | AES-256-GCM ì•”í˜¸í™” |
| Visual Agent | âœ… ì™„ë£Œ | `agents/visual_agent.py` | OpenCV ì–¼êµ´ê°ì§€ + Playwright |
| LLM Manager | âœ… ì™„ë£Œ | `services/llm_manager.py` | OpenAI + Gemini + Claude |

### í”„ë¡ íŠ¸ì—”ë“œ (UI)
| ê¸°ëŠ¥ | ìƒíƒœ | ê²½ë¡œ | ë¹„ê³  |
|------|------|------|------|
| ëŒ€ì‹œë³´ë“œ | âœ… ì™„ë£Œ | `/dashboard` | í›„ë³´ì ëª©ë¡ + í†µê³„ |
| í›„ë³´ì ìƒì„¸ | âœ… ì™„ë£Œ | `/candidates/[id]` | AI ë¶„ì„ ê²°ê³¼ + ì¸ë¼ì¸ í¸ì§‘ |
| ê²€í†  UI | âœ… ì™„ë£Œ | - | ì‹ ë¢°ë„ í‘œì‹œ, ê²½ê³  ë°°ì§€ |
| í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ | âœ… ì™„ë£Œ | `/dashboard` | RDB í•„í„° + Vector ê²€ìƒ‰ |
| ë¸”ë¼ì¸ë“œ ë‚´ë³´ë‚´ê¸° | âœ… ì™„ë£Œ | `/api/candidates/[id]/export` | ë§ˆìŠ¤í‚¹ëœ PDF ë‹¤ìš´ë¡œë“œ |
| ë°°ì¹˜ ì—…ë¡œë“œ UI | âœ… ì™„ë£Œ | `007204a` | ë“œë˜ê·¸ì•¤ë“œë¡­ ë‹¤ì¤‘ íŒŒì¼ |

### ë³´ì•ˆ & í¬ë ˆë”§
| ê¸°ëŠ¥ | ìƒíƒœ | íŒŒì¼ | ë¹„ê³  |
|------|------|------|------|
| AES-256-GCM ì•”í˜¸í™” | âœ… ì™„ë£Œ | `privacy_agent.py` | ëœë¤ salt + PBKDF2 |
| ì›”ë³„ í¬ë ˆë”§ ë¦¬ì…‹ | âœ… ì™„ë£Œ | `004_monthly_credit_reset.sql` | RPC ìë™ ë¦¬ì…‹ |
| í¬ë ˆë”§ ì°¨ê° ì‹œìŠ¤í…œ | âœ… ì™„ë£Œ | `deduct_credit()` | í”Œëœ í¬ë ˆë”§ ìš°ì„  ì‚¬ìš© |
| HWP í˜ì´ì§€ ìˆ˜ ê²€ì¦ | âœ… ì™„ë£Œ | `router_agent.py` | 50í˜ì´ì§€ ì œí•œ ê°•í™” |

## 11.2 ìµœê·¼ ì»¤ë°‹ ì´ë ¥

```
3e42670 feat: Priority 2 Improvements - Library Migration, Timeout & Visual Agent
a73e361 fix: Critical Security & Infrastructure Fixes
007204a feat: Batch Upload UI - Drag & Drop Resume Uploader
b1112d0 feat: Week 7 Hybrid Search + Feedback Loop
97b55d0 feat: Week 6 Review UI - Confidence Display, Inline Edit, Warnings
```

## 11.3 ë‚¨ì€ ì‘ì—… (Priority 3)

| ì‘ì—… | ìš°ì„ ìˆœìœ„ | ìƒíƒœ | ë¹„ê³  |
|------|----------|------|------|
| Polar ê²°ì œ ì—°ë™ | ì¤‘ | â³ ëŒ€ê¸° | Stripe ëŒ€ì²´ |
| ì´ˆê³¼ ì‚¬ìš©ëŸ‰ ê³¼ê¸ˆ | ì¤‘ | â³ ëŒ€ê¸° | Polar API |
| ê²€ìƒ‰ í”¼ë“œë°± ë­í‚¹ ë°˜ì˜ | ë‚® | â³ ëŒ€ê¸° | ê°€ì¤‘ì¹˜ ì¡°ì • |
| Rate Limiting | ë‚® | â³ ëŒ€ê¸° | API ë³´í˜¸ |

## 11.4 ê¸°ìˆ  ìŠ¤íƒ í˜„í™©

```
Frontend:
â”œâ”€â”€ Next.js 15.1.3 (App Router)
â”œâ”€â”€ React 19
â”œâ”€â”€ TypeScript 5
â”œâ”€â”€ Tailwind CSS 3.4
â””â”€â”€ Shadcn/ui

Backend:
â”œâ”€â”€ Supabase (Auth + PostgreSQL + Storage)
â”œâ”€â”€ Redis + RQ (Job Queue)
â””â”€â”€ Python 3.11 Worker

AI/ML:
â”œâ”€â”€ OpenAI GPT-4o (Structured Outputs)
â”œâ”€â”€ Google Gemini 1.5 Pro (google-genai)
â”œâ”€â”€ Anthropic Claude 3.5 Sonnet
â””â”€â”€ OpenAI text-embedding-3-small

File Processing:
â”œâ”€â”€ pdfplumber (PDF)
â”œâ”€â”€ python-docx (DOCX)
â”œâ”€â”€ olefile (HWP)
â”œâ”€â”€ LibreOffice (Fallback ë³€í™˜)
â””â”€â”€ OpenCV (ì–¼êµ´ ê°ì§€)

Deployment:
â”œâ”€â”€ Vercel (Frontend)
â”œâ”€â”€ Railway (Worker)
â””â”€â”€ Supabase Cloud (DB/Auth/Storage)
```

---

ì´ ë¬¸ì„œëŠ” RAI v3.0ì˜ ì™„ì „í•œ ê¸°ìˆ  ì„¤ê³„ì„œì…ë‹ˆë‹¤.
ìµœì¢… ì—…ë°ì´íŠ¸: 2026ë…„ 1ì›” 2ì¼