1. 현재 Multi-Agent Architecture

  1.1 전체 아키텍처 다이어그램

  ┌─────────────────────────────────────────────────────────────────────────────────┐
  │                              CLIENT LAYER                                        │
  │  ┌──────────────────────┐                                                       │
  │  │   Next.js Frontend   │  ← 파일 업로드 UI, 진행 상황 추적                      │
  │  └──────────┬───────────┘                                                       │
  └─────────────┼───────────────────────────────────────────────────────────────────┘
                │ HTTP
  ┌─────────────▼───────────────────────────────────────────────────────────────────┐
  │                           NEXT.JS API LAYER                                      │
  │  ┌────────────┐  ┌──────────────┐  ┌───────────────┐  ┌───────────────┐        │
  │  │  /presign  │  │   /confirm   │  │  /candidates  │  │   /webhooks   │        │
  │  │ (크레딧예약)│  │(매직바이트검증)│  │  (결과 조회)  │  │ (상태 업데이트)│        │
  │  └────────────┘  └──────────────┘  └───────────────┘  └───────────────┘        │
  └─────────────┬───────────────────────────────────────────────────────────────────┘
                │ HTTP / Queue
  ┌─────────────▼───────────────────────────────────────────────────────────────────┐
  │                        FASTAPI WORKER LAYER                                      │
  │                                                                                  │
  │  ┌──────────────────────────────────────────────────────────────────────────┐   │
  │  │                         PIPELINE ORCHESTRATOR                             │   │
  │  │                                                                           │   │
  │  │   ┌─────────────────────────────────────────────────────────────────┐    │   │
  │  │   │  Entry Points:                                                   │    │   │
  │  │   │  • /parse (동기 파싱)     • /process (동기 전체 처리)           │    │   │
  │  │   │  • /analyze (동기 분석)   • /pipeline (동기 파이프라인)         │    │   │
  │  │   │  • /queue/enqueue (비동기 큐 등록)                              │    │   │
  │  │   └─────────────────────────────────────────────────────────────────┘    │   │
  │  └──────────────────────────────────────────────────────────────────────────┘   │
  │                                    │                                             │
  │                                    ▼                                             │
  │  ┌──────────────────────────────────────────────────────────────────────────┐   │
  │  │                            AGENT LAYER                                    │   │
  │  │                                                                           │   │
  │  │   ┌────────────────┐   ┌────────────────┐   ┌────────────────┐          │   │
  │  │   │  RouterAgent   │ → │IdentityChecker │ → │  AnalystAgent  │          │   │
  │  │   │ (파일타입감지) │   │ (다중신원감지) │   │  (AI 분석)     │          │   │
  │  │   │  Magic Number  │   │  GPT-4o-mini   │   │ GPT-4o+Gemini  │          │   │
  │  │   └────────────────┘   └────────────────┘   │   (+Claude)    │          │   │
  │  │           │                     │           └────────────────┘          │   │
  │  │           ▼                     ▼                    │                   │   │
  │  │   ┌────────────────┐   ┌────────────────┐           │                   │   │
  │  │   │   FILE PARSER  │   │ValidationAgent │ ◄─────────┘                   │   │
  │  │   │ ├─ HWPParser   │   │ (검증 및 보정) │                               │   │
  │  │   │ ├─ PDFParser   │   │  Regex + Rule  │                               │   │
  │  │   │ └─ DOCXParser  │   └────────────────┘                               │   │
  │  │   └────────────────┘            │                                        │   │
  │  │                                 ▼                                        │   │
  │  │   ┌────────────────┐   ┌────────────────┐   ┌────────────────┐          │   │
  │  │   │  VisualAgent   │   │  PrivacyAgent  │ → │EmbeddingService│          │   │
  │  │   │ (포트폴리오캡처)│   │ (PII 마스킹)   │   │  (벡터화)      │          │   │
  │  │   │ Playwright+CV2 │   │  AES-256-GCM   │   │ OpenAI Embed   │          │   │
  │  │   └────────────────┘   └────────────────┘   └────────────────┘          │   │
  │  │                                                      │                   │   │
  │  └──────────────────────────────────────────────────────┼───────────────────┘   │
  │                                                         ▼                        │
  │  ┌──────────────────────────────────────────────────────────────────────────┐   │
  │  │                         SERVICE LAYER                                     │   │
  │  │                                                                           │   │
  │  │   ┌────────────────┐   ┌────────────────┐   ┌────────────────┐          │   │
  │  │   │ DatabaseService│   │  QueueService  │   │   LLMManager   │          │   │
  │  │   │  (Supabase)    │   │    (Redis)     │   │ (GPT/Gemini/   │          │   │
  │  │   │                │   │                │   │   Claude)      │          │   │
  │  │   └────────────────┘   └────────────────┘   └────────────────┘          │   │
  │  │                                                                           │   │
  │  └──────────────────────────────────────────────────────────────────────────┘   │
  └─────────────────────────────────────────────────────────────────────────────────┘

  1.2 파이프라인 실행 흐름

                      ┌─────────────────────────────────────────────────────────────┐
                      │                    FULL PIPELINE FLOW                        │
                      └─────────────────────────────────────────────────────────────┘

    ┌─────────────┐       ┌─────────────┐       ┌─────────────┐       ┌─────────────┐
    │   Storage   │  ──▶  │   Router    │  ──▶  │   Parser    │  ──▶  │  Identity   │
    │  Download   │       │   Agent     │       │(HWP/PDF/DOC)│       │   Checker   │
    │             │       │             │       │             │       │             │
    │ Supabase에서│       │• Magic#감지 │       │• 텍스트추출 │       │• 다중신원   │
    │ 파일 다운로드│       │• 암호화체크 │       │• 페이지수   │       │  감지       │
    │             │       │• 50P 제한   │       │• 인코딩변환 │       │• 악용방지   │
    └─────────────┘       └─────────────┘       └─────────────┘       └─────────────┘
          │                     │                     │                     │
          │                     │ rejected?           │                     │ multi?
          │                     ▼ (암호화/50P초과)     │                     ▼ (거절)
          │               ┌───────────┐               │               ┌───────────┐
          │               │   FAIL    │               │               │  REJECT   │
          │               │(크레딧 X) │               │               │(크레딧 X) │
          │               └───────────┘               │               └───────────┘
          ▼                                           ▼                     │
    ┌─────────────┐       ┌─────────────┐       ┌─────────────┐           │
    │   Analyst   │  ──▶  │ Validation  │  ──▶  │   Privacy   │ ◀─────────┘
    │    Agent    │       │   Agent     │       │    Agent    │
    │             │       │             │       │             │
    │• GPT-4o     │       │• 이름검증   │       │• PII 감지   │
    │• Gemini     │       │• URL 추출   │       │• 마스킹     │
    │• Claude(P2) │       │• 경력계산   │       │• AES암호화  │
    │• 교차검증   │       │• 학력파싱   │       │• 해시생성   │
    └─────────────┘       └─────────────┘       └─────────────┘
          │                                           │
          │ parallel (optional)                       │
          ▼                                           ▼
    ┌─────────────┐       ┌─────────────┐       ┌─────────────┐
    │   Visual    │       │  Embedding  │  ──▶  │  Database   │
    │    Agent    │       │   Service   │       │   Service   │
    │             │       │             │       │             │
    │• URL 스크린 │       │• 청킹       │       │• candidates │
    │• 얼굴블러   │       │• OpenAI     │       │• chunks     │
    │• 썸네일생성 │       │  Embedding  │       │• 중복체크   │
    └─────────────┘       └─────────────┘       └─────────────┘
                                                      │
                                                      ▼
                                                ┌───────────┐
                                                │ COMPLETED │
                                                │(크레딧 O) │
                                                └───────────┘

  1.3 각 Agent 역할 요약
  ┌──────────────────┬───────────────────────────────────────┬───────────────────────────────┬─────────────┐
  │      Agent       │                 역할                  │           기술 스택           │    비용     │
  ├──────────────────┼───────────────────────────────────────┼───────────────────────────────┼─────────────┤
  │ RouterAgent      │ 파일 타입 감지, 암호화 체크, 50P 제한 │ Magic Number (규칙 기반)      │ $0          │
  ├──────────────────┼───────────────────────────────────────┼───────────────────────────────┼─────────────┤
  │ IdentityChecker  │ 다중 신원 감지 (악용 방지)            │ GPT-4o-mini                   │ ~$0.001     │
  ├──────────────────┼───────────────────────────────────────┼───────────────────────────────┼─────────────┤
  │ AnalystAgent     │ 이력서 핵심 정보 추출                 │ GPT-4o + Gemini + Claude      │ ~$0.05~0.15 │
  ├──────────────────┼───────────────────────────────────────┼───────────────────────────────┼─────────────┤
  │ ValidationAgent  │ 이름/URL/경력 검증 및 보정            │ Regex + 규칙 기반             │ $0          │
  ├──────────────────┼───────────────────────────────────────┼───────────────────────────────┼─────────────┤
  │ PrivacyAgent     │ PII 마스킹, AES-256 암호화            │ 정규식 + Cryptography         │ $0          │
  ├──────────────────┼───────────────────────────────────────┼───────────────────────────────┼─────────────┤
  │ VisualAgent      │ 포트폴리오 캡처, 얼굴 블러            │ Playwright + OpenCV           │ $0          │
  ├──────────────────┼───────────────────────────────────────┼───────────────────────────────┼─────────────┤
  │ EmbeddingService │ 청킹 및 벡터 생성                     │ OpenAI text-embedding-3-small │ ~$0.002     │
  └──────────────────┴───────────────────────────────────────┴───────────────────────────────┴─────────────┘