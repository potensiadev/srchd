# RAI MVP 최종 작업 리스트

> 작성일: 2026-01-04
> 버전: 1.0

---

## Phase 1: DB 스키마 변경

### 1.1 candidate_raw_texts 테이블 생성

| 구분 | 내용 |
|------|------|
| **AS-IS** | 원본 텍스트 저장 테이블 없음. 분석된 구조화 데이터만 candidates 테이블에 저장 |
| **TO-BE** | `candidate_raw_texts` 테이블 신규 생성하여 파싱된 원본 텍스트 별도 저장 |
| **상세 작업** | - 테이블 생성: `id`, `candidate_id (FK)`, `raw_text (TEXT)`, `created_at` <br>- candidates 테이블과 1:1 관계 <br>- CASCADE DELETE 설정 <br>- RLS 정책: `user_id` 기반 접근 제어 (candidates 테이블 조인) |

### 1.2 candidates 테이블 수정

| 구분 | 내용 |
|------|------|
| **AS-IS** | - `exp_years` (DECIMAL): 경력 연수 <br>- `phone_encrypted`, `email_encrypted`: 암호화된 PII <br>- `phone_masked`, `email_masked`: 마스킹된 PII |
| **TO-BE** | - `exp_total_months` (INTEGER): 경력 개월수 <br>- `phone`, `email`: 원본 PII (암호화/마스킹 없이) <br>- `phone_hash`, `email_hash`: 중복 체크용 해시만 유지 |
| **상세 작업** | - `exp_total_months INTEGER` 컬럼 추가 <br>- `exp_years` 컬럼 제거 또는 deprecated 처리 <br>- `phone_encrypted`, `email_encrypted`, `phone_masked`, `email_masked` 컬럼 제거 <br>- `phone VARCHAR(50)`, `email VARCHAR(255)` 컬럼 추가 (원본 저장) <br>- 기존 인덱스 유지: `phone_hash`, `email_hash` |

### 1.3 user_consents 테이블 수정

| 구분 | 내용 |
|------|------|
| **AS-IS** | `consent_type`: "privacy_policy", "terms_of_service" 등 |
| **TO-BE** | `consent_type`: "third_party_provision" (개인정보 제3자 제공동의) 추가 |
| **상세 작업** | - consent_type ENUM에 `third_party_provision` 값 추가 <br>- 기존 동의 타입 유지 (하위 호환) |

---

## Phase 2: Worker Python 백엔드

### 2.1 Privacy Agent 단순화

| 구분 | 내용 |
|------|------|
| **AS-IS** | - PII 감지 → 마스킹 → AES-256 암호화 → 해시 생성 <br>- `masked_data`, `encrypted_store` 반환 <br>- 복호화 로직 포함 |
| **TO-BE** | - PII 감지 → 해시 생성만 수행 <br>- 마스킹/암호화 로직 제거 <br>- 원본 데이터 그대로 반환 |
| **상세 작업** | - `apps/worker/agents/privacy_agent.py` 수정 <br>- `process()` 메서드: 마스킹/암호화 로직 제거 <br>- `hash_for_dedup()` 메서드: 유지 (중복 체크용) <br>- `decrypt()`, `_mask_*()` 메서드들: 제거 <br>- `PrivacyResult` 타입 단순화: `encrypted_store` 필드 제거 |

### 2.2 원본 텍스트 저장 로직

| 구분 | 내용 |
|------|------|
| **AS-IS** | 파싱된 텍스트는 분석 후 버려짐. DB에 저장되지 않음 |
| **TO-BE** | 파싱된 원본 텍스트를 `candidate_raw_texts` 테이블에 저장 |
| **상세 작업** | - `apps/worker/services/database_service.py` 수정 <br>- `save_candidate()` 메서드에 `raw_text` 파라미터 추가 <br>- candidate 저장 후 `candidate_raw_texts` 테이블에 INSERT <br>- 트랜잭션으로 원자성 보장 |

### 2.3 tasks.py 파이프라인 수정

| 구분 | 내용 |
|------|------|
| **AS-IS** | `process_resume()`에서 `text` 변수는 분석용으로만 사용 |
| **TO-BE** | `text`를 `save_candidate()`에 전달하여 원본 저장 |
| **상세 작업** | - `apps/worker/tasks.py` 수정 <br>- `save_candidate()` 호출 시 `raw_text=text` 파라미터 추가 <br>- Privacy Agent 호출 부분에서 암호화 관련 로직 제거 |

### 2.4 date_parser.py (완료 ✓)

| 구분 | 내용 |
|------|------|
| **AS-IS** | 날짜 파싱 유틸리티 없음. LLM이 추출한 날짜 형식에 의존 |
| **TO-BE** | 다양한 한국어/영어 날짜 형식 파싱 지원 |
| **상세 작업** | - `apps/worker/utils/date_parser.py` 생성 (완료) <br>- 지원 형식: `2020.01`, `2020년 5월`, `'20.01`, `Jan 2020`, `현재`, `재직중` 등 <br>- `parse_date()`, `parse_date_range()` 함수 제공 |

### 2.5 career_calculator.py (완료 ✓)

| 구분 | 내용 |
|------|------|
| **AS-IS** | 경력 연수 계산 없음. LLM이 추정한 값 사용 |
| **TO-BE** | 날짜 기반 정확한 경력 개월수 계산 |
| **상세 작업** | - `apps/worker/utils/career_calculator.py` 생성 (완료) <br>- 중복 기간 자동 제거 (월 단위 비트맵) <br>- `calculate_total_experience()`: 총 경력 개월수 <br>- `format_experience_korean()`: "X년 X개월" 형식 |

### 2.6 education_parser.py (완료 ✓)

| 구분 | 내용 |
|------|------|
| **AS-IS** | 졸업 상태는 LLM 추출에 의존. 부정확할 수 있음 |
| **TO-BE** | 종료일 기반 졸업 상태 자동 판별 |
| **상세 작업** | - `apps/worker/utils/education_parser.py` 생성 (완료) <br>- 종료일 < 현재: `graduated` <br>- 종료일 = 현재~3개월 내: `expected` <br>- 종료일 > 3개월 후: `enrolled` <br>- 학위 수준 자동 판별: doctorate, master, bachelor, associate, high_school |

### 2.7 tasks.py 경력/학력 통합 (완료 ✓)

| 구분 | 내용 |
|------|------|
| **AS-IS** | 분석 결과를 그대로 저장 |
| **TO-BE** | Step 1.6에서 경력 개월수 계산 및 학력 상태 판별 후 저장 |
| **상세 작업** | - `apps/worker/tasks.py` 수정 (완료) <br>- `exp_total_months`, `exp_display` 필드 추가 <br>- 각 education 항목에 `graduation_status`, `degree_level` 추가 |

---

## Phase 3: API (Next.js)

### 3.1 원본 텍스트 조회 API

| 구분 | 내용 |
|------|------|
| **AS-IS** | 원본 텍스트 조회 API 없음 |
| **TO-BE** | `/api/candidates/[id]/raw-text` 엔드포인트 추가 |
| **상세 작업** | - `app/api/candidates/[id]/raw-text/route.ts` 생성 <br>- GET: `candidate_raw_texts` 테이블에서 조회 <br>- RLS 적용: 본인 데이터만 조회 가능 <br>- 응답: `{ raw_text: string, created_at: string }` |

### 3.2 3단계 하이브리드 검색 API

| 구분 | 내용 |
|------|------|
| **AS-IS** | Vector 검색만 사용하거나, 단순 필터 검색 |
| **TO-BE** | 3단계 하이브리드: 구조화 필터 → ILIKE 키워드 → Vector AI |
| **상세 작업** | - `app/api/search/route.ts` 수정 <br>- **Stage 1**: 구조화 필터 (경력 범위, 학력, 기술스택 등) <br>- **Stage 2**: `candidate_raw_texts.raw_text ILIKE '%keyword%'` <br>- **Stage 3**: Vector 유사도 검색 (AI 추천) <br>- 응답 구조: `{ exact_matches: [], ai_recommendations: [] }` |

### 3.3 검색 쿼리 전처리

| 구분 | 내용 |
|------|------|
| **AS-IS** | 검색어 그대로 사용 |
| **TO-BE** | 검색어 정규화 및 토큰화 |
| **상세 작업** | - `lib/search-utils.ts` 생성 <br>- 공백 정규화, 특수문자 처리 <br>- 키워드 토큰화 (AND/OR 검색 지원) <br>- 한글 초성 검색 지원 (선택) |

### 3.4 경력 표시 유틸리티

| 구분 | 내용 |
|------|------|
| **AS-IS** | 프론트엔드에서 경력 연수 직접 표시 |
| **TO-BE** | 개월수 → "X년 X개월" 변환 유틸리티 |
| **상세 작업** | - `lib/format-utils.ts` 생성 <br>- `formatExperienceKorean(months: number): string` <br>- 예: `42` → `"3년 6개월"` |

---

## Phase 4: 동의 프로세스 변경

### 4.1 동의 문구 변경

| 구분 | 내용 |
|------|------|
| **AS-IS** | "개인정보 수집 및 이용 동의" |
| **TO-BE** | "개인정보 제3자 제공동의" |
| **상세 작업** | - 동의 팝업/모달 문구 수정 <br>- 동의 목적: "채용 목적의 제3자(채용담당자) 제공" <br>- 제공 항목: 이름, 연락처, 이메일, 경력, 학력 등 명시 <br>- 보유 기간: 명시 (예: 채용 절차 종료 후 3년) |

### 4.2 동의 컴포넌트 수정

| 구분 | 내용 |
|------|------|
| **AS-IS** | `ConsentModal` 또는 `TermsCheckbox` 컴포넌트 |
| **TO-BE** | 제3자 제공동의 전용 UI |
| **상세 작업** | - `components/consent/ThirdPartyConsentModal.tsx` 생성 또는 기존 수정 <br>- 동의 항목 체크박스 <br>- 약관 전문 보기 링크 <br>- 동의 거부 시 서비스 이용 제한 안내 |

### 4.3 약관 문서 수정

| 구분 | 내용 |
|------|------|
| **AS-IS** | 기존 개인정보처리방침 |
| **TO-BE** | 제3자 제공동의 약관 추가 |
| **상세 작업** | - `public/terms/third-party-provision.md` 또는 `pages/terms/third-party-provision.tsx` <br>- 법적 요건에 맞는 제3자 제공동의 약관 작성 <br>- 제공받는 자, 제공 목적, 제공 항목, 보유 기간, 동의 거부 권리 명시 |

---

## Phase 5: Frontend UI

### 5.1 후보자 상세 Tab UI

| 구분 | 내용 |
|------|------|
| **AS-IS** | 구조화된 데이터만 표시하는 단일 뷰 |
| **TO-BE** | 2개 탭: "구조화 뷰" / "원본 이력서" |
| **상세 작업** | - `components/candidates/CandidateDetailTabs.tsx` 생성 <br>- Tab 1 (구조화 뷰): 기존 UI 유지 (카드 형태, 섹션별 정리) <br>- Tab 2 (원본 이력서): 원본 텍스트 표시 <br>- Tab 전환 시 API 호출 (lazy loading) |

### 5.2 원본 텍스트 뷰어

| 구분 | 내용 |
|------|------|
| **AS-IS** | 없음 |
| **TO-BE** | 원본 텍스트를 읽기 쉽게 표시하는 컴포넌트 |
| **상세 작업** | - `components/candidates/RawTextViewer.tsx` 생성 <br>- 줄바꿈 유지 (`white-space: pre-wrap`) <br>- 검색어 하이라이트 기능 <br>- 복사 버튼 <br>- 폰트: 모노스페이스 또는 가독성 좋은 본문 폰트 |

### 5.3 경력 표시 변경

| 구분 | 내용 |
|------|------|
| **AS-IS** | "경력 3년" 또는 "3 years" |
| **TO-BE** | "경력 3년 6개월" |
| **상세 작업** | - 후보자 카드: `exp_display` 필드 사용 <br>- 후보자 상세: 동일 <br>- 검색 필터: 개월수 범위로 필터링 (예: 36~60개월) <br>- UI 컴포넌트들에서 `exp_years` → `exp_display` 변경 |

### 5.4 검색 결과 2섹션 UI

| 구분 | 내용 |
|------|------|
| **AS-IS** | 검색 결과가 단일 리스트로 표시 |
| **TO-BE** | "정확 일치" 섹션 + "AI 추천" 섹션 분리 |
| **상세 작업** | - `components/search/SearchResults.tsx` 수정 <br>- 섹션 1: "정확 일치 (N건)" - ILIKE 검색 결과 <br>- 섹션 2: "AI 추천 (N건)" - Vector 유사도 검색 결과 <br>- 섹션 구분선 및 라벨 <br>- AI 추천 섹션에 "유사도 점수" 표시 (선택) |

### 5.5 검색 필터 UI 수정

| 구분 | 내용 |
|------|------|
| **AS-IS** | 경력 필터: 연수 단위 (1년, 2년, 3년...) |
| **TO-BE** | 경력 필터: 범위 선택 (신입, 1-3년, 3-5년, 5-10년, 10년+) |
| **상세 작업** | - `components/search/SearchFilters.tsx` 수정 <br>- 경력 범위 선택 UI (라디오 또는 체크박스) <br>- 내부적으로 개월수 범위로 변환: <br>  - 신입: 0-12개월 <br>  - 1-3년: 12-36개월 <br>  - 3-5년: 36-60개월 <br>  - 5-10년: 60-120개월 <br>  - 10년+: 120개월~ |

### 5.6 학력 상태 표시

| 구분 | 내용 |
|------|------|
| **AS-IS** | 학력 상태 표시 없거나 LLM 추출값 사용 |
| **TO-BE** | 자동 판별된 졸업 상태 표시 |
| **상세 작업** | - 후보자 상세 학력 섹션에 상태 뱃지 추가 <br>- `graduated`: "졸업" (회색) <br>- `enrolled`: "재학중" (파란색) <br>- `expected`: "졸업예정" (초록색) <br>- `dropout`: "중퇴" (빨간색) |

---

## Phase 6: 타입 정의

### 6.1 Candidate 타입 수정

| 구분 | 내용 |
|------|------|
| **AS-IS** | `exp_years?: number`, `phone_masked?: string`, `email_masked?: string` |
| **TO-BE** | `exp_total_months?: number`, `exp_display?: string`, `phone?: string`, `email?: string` |
| **상세 작업** | - `types/candidate.ts` 수정 <br>- 암호화/마스킹 관련 필드 제거 <br>- `exp_total_months`, `exp_display` 추가 <br>- `phone`, `email` 원본 필드 추가 |

### 6.2 Education 타입 수정

| 구분 | 내용 |
|------|------|
| **AS-IS** | `school: string`, `major?: string` |
| **TO-BE** | `graduation_status: GraduationStatus`, `degree_level: DegreeLevel` 추가 |
| **상세 작업** | - `types/education.ts` 수정 또는 생성 <br>- `GraduationStatus` enum: graduated, enrolled, expected, dropout, leave, completed <br>- `DegreeLevel` enum: high_school, associate, bachelor, master, doctorate |

### 6.3 SearchResult 타입 추가

| 구분 | 내용 |
|------|------|
| **AS-IS** | 단일 검색 결과 배열 |
| **TO-BE** | 정확 일치 + AI 추천 분리 |
| **상세 작업** | - `types/search.ts` 생성 <br>- `SearchResponse { exact_matches: Candidate[], ai_recommendations: Candidate[], total_exact: number, total_ai: number }` |

---

## Phase 7: 정리 및 제거

### 7.1 암호화 관련 코드 제거

| 구분 | 내용 |
|------|------|
| **AS-IS** | AES-256 암호화/복호화 로직, 키 관리 |
| **TO-BE** | 해당 코드 전체 제거 |
| **상세 작업** | - `apps/worker/agents/privacy_agent.py`: 암호화 메서드 제거 <br>- 환경변수에서 `ENCRYPTION_KEY` 제거 (선택) <br>- 관련 유틸리티 함수 제거 |

### 7.2 마스킹 관련 코드 제거

| 구분 | 내용 |
|------|------|
| **AS-IS** | 전화번호/이메일 마스킹 로직 |
| **TO-BE** | 해당 코드 전체 제거 |
| **상세 작업** | - `_mask_phone()`, `_mask_email()`, `_mask_name()` 등 제거 <br>- 마스킹 관련 타입 정의 제거 |

### 7.3 프론트엔드 복호화 로직 제거

| 구분 | 내용 |
|------|------|
| **AS-IS** | 프론트엔드에서 암호화된 데이터 복호화 |
| **TO-BE** | 원본 데이터 직접 표시 |
| **상세 작업** | - 복호화 API 호출 제거 <br>- `phone_masked` → `phone` 직접 사용 <br>- `email_masked` → `email` 직접 사용 |

---

## 이미 완료된 작업 ✓

| 작업 | 파일 | 상태 |
|------|------|------|
| Multi-Identity Checker | `apps/worker/agents/identity_checker.py` | ✓ 완료 |
| Waterfall Deduplication | `apps/worker/services/database_service.py` | ✓ 완료 |
| Version Stacking | `apps/worker/services/database_service.py` | ✓ 완료 |
| Visual Agent Integration | `apps/worker/tasks.py` | ✓ 완료 |
| URL Extractor (Regex) | `apps/worker/utils/url_extractor.py` | ✓ 완료 |
| Date Parser | `apps/worker/utils/date_parser.py` | ✓ 완료 |
| Career Calculator | `apps/worker/utils/career_calculator.py` | ✓ 완료 |
| Education Parser | `apps/worker/utils/education_parser.py` | ✓ 완료 |
| Pipeline Integration | `apps/worker/tasks.py` Step 1.6 | ✓ 완료 |

---

## 작업 우선순위 요약

| 순위 | Phase | 작업 수 | 핵심 내용 |
|------|-------|---------|----------|
| 1 | Phase 1 | 3개 | DB 스키마 (테이블 생성, 컬럼 수정) |
| 2 | Phase 2 | 3개 | Worker 수정 (Privacy Agent, 원본 저장) |
| 3 | Phase 3 | 4개 | API (원본 조회, 3단계 검색) |
| 4 | Phase 5 | 6개 | Frontend UI (Tab, 검색 결과) |
| 5 | Phase 4 | 3개 | 동의 프로세스 |
| 6 | Phase 6 | 3개 | 타입 정의 |
| 7 | Phase 7 | 3개 | 코드 정리 |

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2026-01-04 | 1.0 | 최초 작성 |
